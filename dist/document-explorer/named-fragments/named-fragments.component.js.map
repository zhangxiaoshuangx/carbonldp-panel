{"version":3,"sources":["document-explorer/named-fragments/named-fragments.component.ts"],"names":[],"mappings":"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","file":"named-fragments.component.js","sourcesContent":["import { Component, ElementRef, Input, Output, EventEmitter, SimpleChange, OnChanges, AfterViewInit } from \"@angular/core\";\n\nimport * as URI from \"carbonldp/RDF/URI\";\n\nimport { NamedFragmentRow } from \"./named-fragment.component\";\nimport { BlankNodeRow } from \"./../blank-nodes/blank-node.component\";\n\nimport $ from \"jquery\";\nimport \"semantic-ui/semantic\";\n\nimport template from \"./named-fragments.component.html!\";\nimport style from \"./named-fragments.component.css!text\";\n\n@Component( {\n\tselector: \"cp-named-fragments\",\n\ttemplate: template,\n\tstyles: [ style ],\n} )\n\nexport class NamedFragmentsComponent implements AfterViewInit, OnChanges {\n\n\telement:ElementRef;\n\t$element:JQuery;\n\n\tnodesTab:JQuery;\n\topenedNamedFragments:NamedFragmentRow[] = [];\n\tnamedFragmentsRecords:NamedFragmentsRecords = new NamedFragmentsRecords();\n\taskingDeletionNamedFragment:NamedFragmentRow;\n\n\t@Input() blankNodes:BlankNodeRow[] = [];\n\t@Input() namedFragments:NamedFragmentRow[] = [];\n\t@Input() documentURI:string = \"\";\n\n\t@Output() onChanges:EventEmitter<NamedFragmentsRecords> = new EventEmitter<NamedFragmentsRecords>();\n\t@Output() onOpenBlankNode:EventEmitter<string> = new EventEmitter<string>();\n\t@Output() onOpenNamedFragment:EventEmitter<string> = new EventEmitter<string>();\n\n\tconstructor( element:ElementRef ) {\n\t\tthis.element = element;\n\t}\n\n\tngAfterViewInit():void {\n\t\tthis.$element = $( this.element.nativeElement );\n\t\tthis.nodesTab = this.$element.find( \".tabular.named-fragments.menu\" );\n\t\tthis.initializeDeletionDimmer();\n\t}\n\n\tngOnChanges( changes:{ [propName:string]:SimpleChange } ):void {\n\t\tif( ( changes[ \"namedFragments\" ].currentValue !== changes[ \"namedFragments\" ].previousValue ) ) {\n\t\t\tthis.openedNamedFragments = [];\n\t\t\tthis.goToNamedFragment( \"all-namedFragments\" );\n\t\t\tthis.namedFragmentsRecords.clear();\n\t\t}\n\t}\n\n\topenNamedFragment( nodeOrId:NamedFragmentRow|string ):void {\n\t\tlet node:NamedFragmentRow;\n\t\tif( typeof nodeOrId === \"string\" ) {\n\t\t\tnode = this.namedFragments.find( ( node ) => { return node.name === nodeOrId} );\n\t\t} else {\n\t\t\tnode = nodeOrId;\n\t\t}\n\t\tif( this.openedNamedFragments.indexOf( node ) === - 1 ) this.openedNamedFragments.push( node );\n\t\tsetTimeout( () => {\n\t\t\tthis.refreshTabs();\n\t\t\tthis.goToNamedFragment( \"named-fragment_\" + this.getNormalizedUri( node.name ) );\n\t\t}, 50 );\n\t}\n\n\topenBlankNode( id:string ):void {\n\t\tthis.onOpenBlankNode.emit( id );\n\t}\n\n\tgoToNamedFragment( id:string ) {\n\t\tif( ! this.nodesTab )\n\t\t\treturn;\n\t\tthis.nodesTab.find( \"> [data-tab='\" + id + \"']\" ).click();\n\t\tthis.onOpenNamedFragment.emit( \"namedFragments\" );\n\t}\n\n\tcloseNamedFragment( namedFragment:NamedFragmentRow, index?:number ):void {\n\t\tthis.openedNamedFragments.splice( index, 1 );\n\t\tthis.goToNamedFragment( \"all-namedFragments\" );\n\t}\n\n\trefreshTabs():void {\n\t\tlet items:JQuery = this.nodesTab.find( \">.item\" );\n\t\titems.removeData();\n\t\t// The destroy is because JQuery uses a cache version of all data attributes. So we need to clear the data attributes to get the new tabs ids.\n\t\titems.tab( \"destroy\" );\n\t\titems.tab();\n\t}\n\n\tgetNormalizedUri( uri:string ):string {\n\t\treturn uri.replace( /[^\\w\\s]/gi, \"\" );\n\t}\n\n\tgetSlug( uri:string ) {\n\t\treturn URI.Util.getSlug( uri );\n\t}\n\n\tchangeNamedFragment( namedFragmentRow:NamedFragmentRow, index?:number ):void {\n\t\tif( typeof this.namedFragmentsRecords === \"undefined\" ) this.namedFragmentsRecords = new NamedFragmentsRecords();\n\t\tif( typeof namedFragmentRow.modified !== \"undefined\" ) {\n\t\t\tthis.namedFragmentsRecords.changes.set( namedFragmentRow.id, namedFragmentRow );\n\t\t} else if( typeof namedFragmentRow.added === \"undefined\" ) {\n\t\t\tthis.namedFragmentsRecords.changes.delete( namedFragmentRow.id );\n\t\t}\n\t\tthis.refreshTabs();\n\t\tthis.onChanges.emit( this.namedFragmentsRecords );\n\t}\n\n\tdeleteNamedFragment( namedFragmentRow:NamedFragmentRow, index?:number ):void {\n\t\tindex = this.openedNamedFragments.indexOf( namedFragmentRow );\n\t\tthis.openedNamedFragments.splice( index, 1 );\n\t\tif( typeof this.namedFragmentsRecords === \"undefined\" ) this.namedFragmentsRecords = new NamedFragmentsRecords();\n\t\tif( typeof namedFragmentRow.added !== \"undefined\" ) {\n\t\t\tthis.namedFragmentsRecords.additions.delete( namedFragmentRow.id );\n\t\t} else if( typeof namedFragmentRow.modified !== \"undefined\" ) {\n\t\t\tthis.namedFragmentsRecords.changes.delete( namedFragmentRow.id );\n\t\t\tthis.namedFragmentsRecords.deletions.set( namedFragmentRow.id, namedFragmentRow );\n\t\t} else {\n\t\t\tthis.namedFragmentsRecords.deletions.set( namedFragmentRow.id, namedFragmentRow );\n\t\t}\n\t\tindex = this.namedFragments.indexOf( namedFragmentRow );\n\t\tthis.namedFragments.splice( index, 1 );\n\t\tthis.refreshTabs();\n\t\tthis.onChanges.emit( this.namedFragmentsRecords );\n\t}\n\n\tcreateNamedFragment():void {\n\t\tlet newName:string = this.documentURI + \"#New-Fragment-Name-\";\n\t\tlet newFragments:NamedFragmentRow[] = this.namedFragments.filter( ( namedFragment:NamedFragmentRow ) => { return namedFragment.name.startsWith( newName ) } );\n\t\tlet id:string = newName + (newFragments.length + 1);\n\t\tlet newNamedFragment:NamedFragmentRow = <NamedFragmentRow>{\n\t\t\tid: id,\n\t\t\tname: id,\n\t\t\tcopy: {\n\t\t\t\t\"@id\": id\n\t\t\t}\n\t\t};\n\t\tnewNamedFragment.added = newNamedFragment.copy;\n\t\tthis.namedFragments.splice( 0, 0, newNamedFragment );\n\t\tthis.namedFragmentsRecords.additions.set( id, newNamedFragment );\n\t\tthis.refreshTabs();\n\t\tthis.onChanges.emit( this.namedFragmentsRecords );\n\t\tthis.openNamedFragment( id );\n\t}\n\n\tinitializeDeletionDimmer():void {\n\t\tthis.$element.find( \".confirm-deletion.dimmer\" ).dimmer( { closable: false } );\n\t}\n\n\taskToConfirmDeletion( clickEvent:Event, blankNode:BlankNodeRow ):void {\n\t\tclickEvent.stopPropagation();\n\t\tthis.askingDeletionNamedFragment = blankNode;\n\t\tthis.$element.find( \".confirm-deletion.dimmer\" ).dimmer( \"show\" );\n\t}\n\n\tconfirmDeletion():void {\n\t\tthis.deleteNamedFragment( this.askingDeletionNamedFragment );\n\t\tthis.$element.find( \".confirm-deletion.dimmer\" ).dimmer( \"hide\" );\n\t}\n\n\tcancelDeletion():void {\n\t\tthis.askingDeletionNamedFragment = null;\n\t\tthis.$element.find( \".confirm-deletion.dimmer\" ).dimmer( \"hide\" );\n\t}\n\n}\n\nexport class NamedFragmentsRecords {\n\tchanges:Map<string,NamedFragmentRow> = new Map<string, NamedFragmentRow>();\n\tdeletions:Map<string,NamedFragmentRow> = new Map<string, NamedFragmentRow>();\n\tadditions:Map<string,NamedFragmentRow> = new Map<string, NamedFragmentRow>();\n\n\tclear():void {\n\t\tthis.changes.clear();\n\t\tthis.deletions.clear();\n\t\tthis.additions.clear();\n\t}\n}\nexport default NamedFragmentsComponent;"]}