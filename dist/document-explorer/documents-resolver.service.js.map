{"version":3,"sources":["document-explorer/documents-resolver.service.ts"],"names":[],"mappings":"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","file":"documents-resolver.service.js","sourcesContent":["import { Injectable } from \"@angular/core\";\r\n\r\nimport Carbon from \"carbonldp/Carbon\";\r\nimport * as HTTP from \"carbonldp/HTTP\";\r\nimport * as NS from \"carbonldp/NS\";\r\nimport * as SDKContext from \"carbonldp/SDKContext\";\r\nimport * as RDFDocument from \"carbonldp/RDF/Document\";\r\nimport * as PersistedDocument from \"carbonldp/PersistedDocument\";\r\nimport * as AccessPoint from \"carbonldp/AccessPoint\";\r\n\r\n@Injectable()\r\nexport class DocumentsResolverService {\r\n\r\n\tcarbon:Carbon;\r\n\r\n\tdocuments:Map<string,  { document:RDFDocument.Class, ETag:string }> = new Map<string, { document:RDFDocument.Class, ETag:string }>();\r\n\tprivate parser:RDFDocument.Parser = new RDFDocument.Parser();\r\n\r\n\tconstructor( carbon:Carbon ) {\r\n\t\tthis.carbon = carbon;\r\n\t}\r\n\r\n\tget( uri:string, documentContext:SDKContext.Class ):Promise<RDFDocument.Class | null> {\r\n\t\tif( ! uri || ! documentContext ) return <any> Promise.reject( new Error( \"Provide the required parameters\" ) );\r\n\t\tlet requestOptions:HTTP.Request.Options = { sendCredentialsOnCORS: true, };\r\n\t\tif( documentContext && documentContext.auth.isAuthenticated() ) documentContext.auth.addAuthentication( requestOptions );\r\n\r\n\t\tHTTP.Request.Util.setAcceptHeader( \"application/ld+json\", requestOptions );\r\n\t\tHTTP.Request.Util.setPreferredInteractionModel( NS.LDP.Class.RDFSource, requestOptions );\r\n\r\n\t\tlet eTag:string;\r\n\r\n\t\treturn HTTP.Request.Service.get( uri, requestOptions ).then( ( response:HTTP.Response.Class ) => {\r\n\t\t\teTag = HTTP.Response.Util.getETag( response );\r\n\t\t\treturn this.parser.parse( response.data );\r\n\t\t} ).then( ( parsedDocuments:any ) => {\r\n\t\t\tif( ! parsedDocuments[ 0 ] ) return null;\r\n\r\n\t\t\tlet parsedDocument:RDFDocument.Class = parsedDocuments[ 0 ];\r\n\r\n\t\t\tthis.documents.set( uri, { document: parsedDocument, ETag: eTag } );\r\n\r\n\t\t\treturn parsedDocument;\r\n\t\t} ).catch( ( error ) => {\r\n\t\t\tconsole.error( error );\r\n\t\t\treturn Promise.reject( error );\r\n\t\t} );\r\n\t}\r\n\r\n\tgetAll():Promise<RDFDocument.Class[]> {\r\n\t\treturn new Promise<RDFDocument.Class[]>( ( resolve:( result:any ) => void, reject:( error:Error ) => void ) => {\r\n\t\t\tlet keys = Object.keys( this.documents );\r\n\t\t\tlet values = keys.map( ( v ) => { return this.documents[ v ].document; } );\r\n\t\t\tresolve( values );\r\n\t\t} );\r\n\t}\r\n\r\n\tcreateChild( context:SDKContext.Class, parentURI:string, content:any, childSlug?:string ):Promise<PersistedDocument.Class> {\r\n\t\treturn context.documents.createChild( parentURI, content, childSlug ).then(\r\n\t\t\t( [ createdChild, response ]:[ PersistedDocument.Class, HTTP.Response.Class ] ) => {\r\n\t\t\t\treturn createdChild;\r\n\t\t\t}\r\n\t\t).catch( ( error ) => {\r\n\t\t\tconsole.error( error );\r\n\t\t\treturn Promise.reject( error );\r\n\t\t} );\r\n\t}\r\n\r\n\tcreateAccessPoint( document:PersistedDocument.Class, accessPoint:AccessPoint.Class, slug?:string ):Promise<PersistedDocument.Class> {\r\n\t\treturn document.createAccessPoint( accessPoint, slug ).then(\r\n\t\t\t( [ createdChild, response ]:[ PersistedDocument.Class, HTTP.Response.Class ] ) => {\r\n\t\t\t\treturn createdChild;\r\n\t\t\t}\r\n\t\t).catch( ( error ) => {\r\n\t\t\tconsole.error( error );\r\n\t\t\treturn Promise.reject( error );\r\n\t\t} );\r\n\t}\r\n\r\n\tdelete( context:SDKContext.Class, documentURI:string ):Promise<HTTP.Response.Class> {\r\n\t\treturn context.documents.delete( documentURI ).catch( ( error ) => {\r\n\t\t\tconsole.error( error );\r\n\t\t\treturn Promise.reject( error );\r\n\t\t} );\r\n\t}\r\n\r\n\tupdate( uri:string, body:string, documentContext:SDKContext.Class ):Promise<RDFDocument.Class> {\r\n\t\tif( ! uri || ! body ) return <any> Promise.reject( new Error( \"Provide the required parameters\" ) );\r\n\t\t//Refresh document ETag\r\n\t\tlet eTag:string = this.documents.get( uri ).ETag;\r\n\t\treturn this.callUpdate( uri, body, eTag, documentContext );\r\n\t}\r\n\r\n\tprivate callUpdate( uri:string, body:string, eTag:string, documentContext:SDKContext.Class ):Promise<RDFDocument.Class> {\r\n\t\tlet requestOptions:HTTP.Request.Options = { sendCredentialsOnCORS: true, };\r\n\t\tif( documentContext && documentContext.auth.isAuthenticated() ) documentContext.auth.addAuthentication( requestOptions );\r\n\t\tHTTP.Request.Util.setAcceptHeader( \"application/ld+json\", requestOptions );\r\n\t\tHTTP.Request.Util.setContentTypeHeader( \"application/ld+json\", requestOptions );\r\n\t\tHTTP.Request.Util.setIfMatchHeader( eTag, requestOptions );\r\n\t\tHTTP.Request.Util.setPreferredInteractionModel( NS.LDP.Class.RDFSource, requestOptions );\r\n\t\treturn HTTP.Request.Service.put( uri, body, requestOptions ).then( ( response:HTTP.Response.Class ) => {\r\n\t\t\treturn this.get( uri, documentContext );\r\n\t\t} ).then( ( parsedDocument:RDFDocument.Class ) => {\r\n\t\t\tif( ! parsedDocument ) return null;\r\n\t\t\treturn parsedDocument;\r\n\t\t} ).catch( ( error ) => {\r\n\t\t\tconsole.error( error );\r\n\t\t\treturn Promise.reject( error );\r\n\t\t} );\r\n\t}\r\n}\r\n\r\nexport default DocumentsResolverService;\r\n"]}