{"version":3,"sources":["document-explorer/documents-resolver.service.ts"],"names":[],"mappings":"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","file":"documents-resolver.service.js","sourcesContent":["import { Injectable } from \"@angular/core\";\n\nimport Carbon from \"carbonldp/Carbon\";\nimport * as HTTP from \"carbonldp/HTTP\";\nimport * as NS from \"carbonldp/NS\";\nimport * as SDKContext from \"carbonldp/SDKContext\";\nimport * as RDFDocument from \"carbonldp/RDF/Document\";\nimport * as PersistedDocument from \"carbonldp/PersistedDocument\";\nimport * as AccessPoint from \"carbonldp/AccessPoint\";\n\n@Injectable()\nexport class DocumentsResolverService {\n\n\tcarbon:Carbon;\n\n\tdocuments:Map<string,  { document:RDFDocument.Class, ETag:string }> = new Map<string, { document:RDFDocument.Class, ETag:string }>();\n\tprivate parser:RDFDocument.Parser = new RDFDocument.Parser();\n\n\tconstructor( carbon:Carbon ) {\n\t\tthis.carbon = carbon;\n\t}\n\n\tget( uri:string, documentContext:SDKContext.Class ):Promise<RDFDocument.Class | null> {\n\t\tif( ! uri || ! documentContext ) return <any> Promise.reject( new Error( \"Provide the required parameters\" ) );\n\t\tlet requestOptions:HTTP.Request.Options = { sendCredentialsOnCORS: true, };\n\t\tif( documentContext && documentContext.auth.isAuthenticated() ) documentContext.auth.addAuthentication( requestOptions );\n\n\t\tHTTP.Request.Util.setAcceptHeader( \"application/ld+json\", requestOptions );\n\t\tHTTP.Request.Util.setPreferredInteractionModel( NS.LDP.Class.RDFSource, requestOptions );\n\n\t\tlet eTag:string;\n\n\t\treturn HTTP.Request.Service.get( uri, requestOptions ).then( ( response:HTTP.Response.Class ) => {\n\t\t\teTag = HTTP.Response.Util.getETag( response );\n\t\t\treturn this.parser.parse( response.data );\n\t\t} ).then( ( parsedDocuments:any ) => {\n\t\t\tif( ! parsedDocuments[ 0 ] ) return null;\n\n\t\t\tlet parsedDocument:RDFDocument.Class = parsedDocuments[ 0 ];\n\n\t\t\tthis.documents.set( uri, { document: parsedDocument, ETag: eTag } );\n\n\t\t\treturn parsedDocument;\n\t\t} ).catch( ( error ) => {\n\t\t\tconsole.error( error );\n\t\t\treturn Promise.reject( error );\n\t\t} );\n\t}\n\n\tgetAll():Promise<RDFDocument.Class[]> {\n\t\treturn new Promise<RDFDocument.Class[]>( ( resolve:( result:any ) => void, reject:( error:Error ) => void ) => {\n\t\t\tlet keys = Object.keys( this.documents );\n\t\t\tlet values = keys.map( ( v ) => { return this.documents[ v ].document; } );\n\t\t\tresolve( values );\n\t\t} );\n\t}\n\n\tcreateChild( context:SDKContext.Class, parentURI:string, content:any, childSlug?:string ):Promise<PersistedDocument.Class> {\n\t\treturn context.documents.createChild( parentURI, content, childSlug ).then(\n\t\t\t( [ createdChild, response ]:[ PersistedDocument.Class, HTTP.Response.Class ] ) => {\n\t\t\t\treturn createdChild;\n\t\t\t}\n\t\t).catch( ( error ) => {\n\t\t\tconsole.error( error );\n\t\t\treturn Promise.reject( error );\n\t\t} );\n\t}\n\n\tcreateAccessPoint( document:PersistedDocument.Class, accessPoint:AccessPoint.Class, slug?:string ):Promise<PersistedDocument.Class> {\n\t\treturn document.createAccessPoint( accessPoint, slug ).then(\n\t\t\t( [ createdChild, response ]:[ PersistedDocument.Class, HTTP.Response.Class ] ) => {\n\t\t\t\treturn createdChild;\n\t\t\t}\n\t\t).catch( ( error ) => {\n\t\t\tconsole.error( error );\n\t\t\treturn Promise.reject( error );\n\t\t} );\n\t}\n\n\tdelete( context:SDKContext.Class, documentURI:string ):Promise<HTTP.Response.Class> {\n\t\treturn context.documents.delete( documentURI ).catch( ( error ) => {\n\t\t\tconsole.error( error );\n\t\t\treturn Promise.reject( error );\n\t\t} );\n\t}\n\n\tupdate( uri:string, body:string, documentContext:SDKContext.Class ):Promise<RDFDocument.Class> {\n\t\tif( ! uri || ! body ) return <any> Promise.reject( new Error( \"Provide the required parameters\" ) );\n\t\t//Refresh document ETag\n\t\tlet eTag:string = this.documents.get( uri ).ETag;\n\t\treturn this.callUpdate( uri, body, eTag, documentContext );\n\t}\n\n\tprivate callUpdate( uri:string, body:string, eTag:string, documentContext:SDKContext.Class ):Promise<RDFDocument.Class> {\n\t\tlet requestOptions:HTTP.Request.Options = { sendCredentialsOnCORS: true, };\n\t\tif( documentContext && documentContext.auth.isAuthenticated() ) documentContext.auth.addAuthentication( requestOptions );\n\t\tHTTP.Request.Util.setAcceptHeader( \"application/ld+json\", requestOptions );\n\t\tHTTP.Request.Util.setContentTypeHeader( \"application/ld+json\", requestOptions );\n\t\tHTTP.Request.Util.setIfMatchHeader( eTag, requestOptions );\n\t\tHTTP.Request.Util.setPreferredInteractionModel( NS.LDP.Class.RDFSource, requestOptions );\n\t\treturn HTTP.Request.Service.put( uri, body, requestOptions ).then( ( response:HTTP.Response.Class ) => {\n\t\t\treturn this.get( uri, documentContext );\n\t\t} ).then( ( parsedDocument:RDFDocument.Class ) => {\n\t\t\tif( ! parsedDocument ) return null;\n\t\t\treturn parsedDocument;\n\t\t} ).catch( ( error ) => {\n\t\t\tconsole.error( error );\n\t\t\treturn Promise.reject( error );\n\t\t} );\n\t}\n}\n\nexport default DocumentsResolverService;\n"]}