{"version":3,"sources":["document-explorer/documents-resolver.service.ts"],"names":[],"mappings":"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","file":"documents-resolver.service.js","sourcesContent":["import { Injectable } from \"@angular/core\";\n\nimport Carbon from \"carbonldp/Carbon\";\nimport * as HTTP from \"carbonldp/HTTP\";\nimport * as NS from \"carbonldp/NS\";\nimport * as SDKContext from \"carbonldp/SDKContext\";\nimport * as RDFDocument from \"carbonldp/RDF/Document\";\nimport * as PersistedDocument from \"carbonldp/PersistedDocument\";\nimport * as AccessPoint from \"carbonldp/AccessPoint\";\n\n@Injectable()\nexport class DocumentsResolverService {\n\n\tcarbon:Carbon;\n\n\tdocuments:Map<string,  {document:RDFDocument.Class, ETag:string}> = new Map<string, {document:RDFDocument.Class, ETag:string}>();\n\tprivate parser:RDFDocument.Parser = new RDFDocument.Parser();\n\n\tconstructor( carbon:Carbon ) {\n\t\tthis.carbon = carbon;\n\t}\n\n\tget( uri:string, documentContext:SDKContext.Class ):Promise<RDFDocument.Class> {\n\t\tif( ! uri || ! documentContext ) return <any> Promise.reject( new Error( \"Provide the required parameters\" ) );\n\t\tlet requestOptions:HTTP.Request.Options = { sendCredentialsOnCORS: true, };\n\t\tif( documentContext && documentContext.auth.isAuthenticated() ) documentContext.auth.addAuthentication( requestOptions );\n\n\t\tHTTP.Request.Util.setAcceptHeader( \"application/ld+json\", requestOptions );\n\t\tHTTP.Request.Util.setPreferredInteractionModel( NS.LDP.Class.RDFSource, requestOptions );\n\t\treturn HTTP.Request.Service.get( uri, requestOptions ).then( ( response:HTTP.Response.Class ) => {\n\t\t\tlet eTag:string = HTTP.Response.Util.getETag( response );\n\t\t\treturn this.parser.parse( response.data ).then( ( persistedDocument:RDFDocument.Class )=> {\n\t\t\t\treturn [ persistedDocument, eTag ];\n\t\t\t} );\n\t\t} ).then( ( [parsedDocument, eTag]:[RDFDocument.Class, string] ) => {\n\t\t\tif( ! parsedDocument[ 0 ] ) return null;\n\t\t\tthis.documents.set( uri, { document: parsedDocument, ETag: eTag } );\n\t\t\treturn parsedDocument;\n\t\t} ).catch( ( error ) => {\n\t\t\tconsole.error( error );\n\t\t\treturn Promise.reject( error );\n\t\t} );\n\t}\n\n\tgetAll():Promise<RDFDocument.Class[]> {\n\t\treturn new Promise<RDFDocument.Class[]>( ( resolve:( result:any ) => void, reject:( error:Error ) => void ) => {\n\t\t\tlet keys = Object.keys( this.documents );\n\t\t\tlet values = keys.map( ( v ) => { return this.documents[ v ].document; } );\n\t\t\tresolve( values );\n\t\t} );\n\t}\n\n\tcreateChild( context:SDKContext.Class, parentURI:string, content:any, childSlug?:string ):Promise<PersistedDocument.Class> {\n\t\treturn context.documents.createChild( parentURI, content, childSlug ).then(\n\t\t\t( [createdChild, response]:[PersistedDocument.Class, HTTP.Response.Class] )=> {\n\t\t\t\treturn createdChild;\n\t\t\t}\n\t\t).catch( ( error ) => {\n\t\t\tconsole.error( error );\n\t\t\treturn Promise.reject( error );\n\t\t} );\n\t}\n\n\tcreateAccessPoint( document:PersistedDocument.Class, accessPoint:AccessPoint.Class, slug?:string ):Promise<PersistedDocument.Class> {\n\t\treturn document.createAccessPoint( accessPoint, slug ).then(\n\t\t\t( [createdChild, response]:[PersistedDocument.Class, HTTP.Response.Class] )=> {\n\t\t\t\treturn createdChild;\n\t\t\t}\n\t\t).catch( ( error ) => {\n\t\t\tconsole.error( error );\n\t\t\treturn Promise.reject( error );\n\t\t} );\n\t}\n\n\tdelete( context:SDKContext.Class, documentURI:string ):Promise<HTTP.Response.Class> {\n\t\treturn context.documents.delete( documentURI ).catch( ( error ) => {\n\t\t\tconsole.error( error );\n\t\t\treturn Promise.reject( error );\n\t\t} );\n\t}\n\n\tupdate( uri:string, body:string, documentContext:SDKContext.Class ):Promise<RDFDocument.Class> {\n\t\tif( ! uri || ! body ) return <any> Promise.reject( new Error( \"Provide the required parameters\" ) );\n\t\t//Refresh document ETag\n\t\tlet eTag:string = this.documents.get( uri ).ETag;\n\t\treturn this.callUpdate( uri, body, eTag, documentContext );\n\t}\n\n\tprivate callUpdate( uri:string, body:string, eTag:string, documentContext:SDKContext.Class ):Promise<RDFDocument.Class> {\n\t\tlet requestOptions:HTTP.Request.Options = { sendCredentialsOnCORS: true, };\n\t\tif( documentContext && documentContext.auth.isAuthenticated() ) documentContext.auth.addAuthentication( requestOptions );\n\t\tHTTP.Request.Util.setAcceptHeader( \"application/ld+json\", requestOptions );\n\t\tHTTP.Request.Util.setContentTypeHeader( \"application/ld+json\", requestOptions );\n\t\tHTTP.Request.Util.setIfMatchHeader( eTag, requestOptions );\n\t\tHTTP.Request.Util.setPreferredInteractionModel( NS.LDP.Class.RDFSource, requestOptions );\n\t\treturn HTTP.Request.Service.put( uri, body, requestOptions ).then( ( response:HTTP.Response.Class ) => {\n\t\t\treturn this.get( uri, documentContext );\n\t\t} ).then( ( parsedDocument:RDFDocument.Class ) => {\n\t\t\tif( ! parsedDocument[ 0 ] ) return null;\n\t\t\treturn parsedDocument;\n\t\t} ).catch( ( error ) => {\n\t\t\tconsole.error( error );\n\t\t\treturn Promise.reject( error );\n\t\t} );\n\t}\n}\n\nexport default DocumentsResolverService;\n"]}