{"version":3,"sources":["my-apps/app-content/configuration/backup/backup-exporter/backup-exporter.component.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,qBAAkE,eAAe,CAAC,CAAA;AAElF,IAAY,GAAG,WAAM,eAAe,CAAC,CAAA;AACrC,IAAY,iBAAiB,WAAM,6BAA6B,CAAC,CAAA;AAIjE,6BAA4B,wBAAwB,CAAC,CAAA;AACrD,IAAY,GAAG,WAAM,eAAe,CAAC,CAAA;AAErC,QAAO,sBAAsB,CAAC,CAAA;AAQ9B;IAYC,iCAAa,WAAuB;QAVpC,oBAAe,GAAW,KAAK,CAAC;QAChC,kBAAa,GAAa,EAAE,CAAC;QAOnB,oBAAe,GAAyB,IAAI,mBAAY,EAAW,CAAC;QAG7E,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;IAChC,CAAC;IAED,kDAAgB,GAAhB;QAAA,iBA4BC;QA3BA,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAC5B,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;QAE3B,IAAI,CAAC,WAAW,CAAC,MAAM,CAAE,IAAI,CAAC,SAAS,CAAE,CAAC,IAAI,CAAE,UAAE,SAAiC;YAClF,MAAM,CAAC,KAAI,CAAC,gBAAgB,CAAE,SAAS,CAAE,CAAC,KAAK,CAAE,UAAE,gBAAkD;gBACpG,EAAE,CAAA,CAAE,gBAAgB,CAAC,cAAc,CAAE,UAAU,CAAG,CAAC;oBAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAE,gBAAgB,CAAE,CAAC;gBAC9F,IAAI,YAAY,GAAoB;oBACnC,KAAK,EAAE,0BAA0B;oBACjC,OAAO,EAAE,0IAA0I;oBACnJ,aAAa,EAAE,SAAS,CAAE,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAE;iBAC3D,CAAC;gBACF,KAAI,CAAC,aAAa,CAAC,IAAI,CAAE,YAAY,CAAE,CAAC;YACzC,CAAC,CAAE,CAAC;QACL,CAAC,CAAE,CAAC,IAAI,CAAE;YACT,KAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC3B,CAAC,CAAE,CAAC,KAAK,CAAE,UAAE,KAAe;YAC3B,IAAI,YAAY,GAAoB;gBACnC,KAAK,EAAE,KAAK,CAAC,IAAI;gBACjB,OAAO,EAAE,0BAA0B;gBACnC,QAAQ,EAAQ,KAAK,CAAC,QAAQ,CAAC,OAAQ,CAAC,WAAW;gBACnD,UAAU,EAAE,EAAE,GAAoB,KAAK,CAAC,QAAQ,CAAC,OAAQ,CAAC,MAAM;gBAChE,aAAa,EAAmB,KAAK,CAAC,QAAQ,CAAC,OAAQ,CAAC,UAAU;aAClE,CAAC;YACF,KAAI,CAAC,aAAa,CAAC,IAAI,CAAE,YAAY,CAAE,CAAC;QACzC,CAAC,CAAE,CAAC,IAAI,CAAE;YACT,KAAI,CAAC,eAAe,GAAG,KAAK,CAAC;QAC9B,CAAC,CAAE,CAAC;IACL,CAAC;IAED,kDAAgB,GAAhB,UAAkB,SAAiC;QAAnD,iBA8BC;QA7BA,MAAM,CAAC,IAAI,OAAO,CAA2B,UAAE,OAA8B,EAAE,MAA0D;YACxI,yHAAyH;YACzH,KAAI,CAAC,wBAAwB,GAAQ,WAAW,CAAE;gBACjD,SAAS,CAAC,OAAO,EAAE,CAAC,IAAI,CAAE;oBACzB,MAAM,CAAA,CAAE,SAAS,CAAE,GAAG,CAAC,SAAS,CAAC,MAAM,CAAE,CAAC,EAAG,CAAC,CAAC,CAAC;wBAC/C,KAAK,GAAG,CAAC,eAAe,CAAC,QAAQ;4BAChC,aAAa,CAAE,KAAI,CAAC,wBAAwB,CAAE,CAAC;4BAC/C,OAAO,CAAE,SAAS,CAAE,CAAC;4BACrB,KAAI,CAAC,eAAe,CAAC,IAAI,CAAE,IAAI,CAAE,CAAC;4BAClC,KAAK,CAAC;wBACP,KAAK,GAAG,CAAC,eAAe,CAAC,KAAK;4BAC7B,aAAa,CAAE,KAAI,CAAC,wBAAwB,CAAE,CAAC;4BAC/C,MAAM,CAAE,SAAS,CAAE,CAAC;4BACpB,KAAK,CAAC;oBACR,CAAC;gBACF,CAAC,CAAE,CAAC,KAAK,CAAE,UAAE,KAAe;oBAC3B,IAAI,YAAY,GAAoB;wBACnC,KAAK,EAAE,KAAK,CAAC,IAAI;wBACjB,OAAO,EAAE,+CAA+C;wBACxD,QAAQ,EAAQ,KAAK,CAAC,QAAQ,CAAC,OAAQ,CAAC,WAAW;wBACnD,UAAU,EAAE,EAAE,GAAoB,KAAK,CAAC,QAAQ,CAAC,OAAQ,CAAC,MAAM;wBAChE,aAAa,EAAmB,KAAK,CAAC,QAAQ,CAAC,OAAQ,CAAC,UAAU;qBAClE,CAAC;oBACF,KAAI,CAAC,aAAa,GAAG,CAAE,YAAY,CAAE,CAAC;oBACtC,aAAa,CAAE,KAAI,CAAC,wBAAwB,CAAE,CAAC;oBAC/C,KAAI,CAAC,eAAe,GAAG,KAAK,CAAC;gBAC9B,CAAC,CAAE,CAAC;YACL,CAAC,EAAE,IAAI,CAAE,CAAC;QACX,CAAC,CAAE,CAAC;IACL,CAAC;IAED,6CAAW,GAAX;QACC,EAAE,CAAA,CAAE,OAAO,IAAI,CAAC,wBAAwB,KAAK,WAAY,CAAC;YAAC,aAAa,CAAE,IAAI,CAAC,wBAAwB,CAAE,CAAC;IAC3G,CAAC;IAED,+CAAa,GAAb,UAAe,KAAY;QAC1B,IAAI,CAAC,aAAa,CAAC,MAAM,CAAE,KAAK,EAAE,CAAC,CAAE,CAAC;IACvC,CAAC;IAED,gDAAc,GAAd;QACC,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;IAC5B,CAAC;IAED,8CAAY,GAAZ,UAAc,UAAsB;QACnC,CAAC,CAAE,UAAU,CAAE,CAAC,UAAU,CAAE,EAAE,SAAS,EAAE,MAAM,EAAE,CAAE,CAAC;IACrD,CAAC;IApFD;QAAC,YAAK,EAAE;sCAAgB,OAAO;+DAAvB;IACR;QAAC,YAAK,EAAE;;8DAAA;IACR;QAAC,aAAM,EAAE;;oEAAA;IAhBV;QAAC,gBAAS,CAAE;YACX,QAAQ,EAAE,oBAAoB;YAC9B,QAAQ,EAAE,OAAO,CAAE,kCAAkC,CAAE;YACvD,MAAM,EAAE,CAAE,OAAO,CAAE,iCAAiC,CAAE,CAAE;SACxD,CAAE;;+BAAA;IA+FH,8BAAC;AAAD,CA7FA,AA6FC,IAAA;AA7FY,+BAAuB,0BA6FnC,CAAA;AAED;kBAAe,uBAAuB,CAAC","file":"backup-exporter.component.js","sourcesContent":["import { Component, Input, Output, EventEmitter, OnDestroy } from \"@angular/core\";\n\nimport * as App from \"carbonldp/App\";\nimport * as PersistedDocument from \"carbonldp/PersistedDocument\";\nimport { Error as HTTPError } from \"carbonldp/HTTP/Errors\";\n\nimport { Message } from \"carbonldp-panel/errors-area/error-message.component\";\nimport { JobsService } from \"../../job/jobs.service\";\nimport * as Job from \"../../job/job\";\n\nimport \"semantic-ui/semantic\";\n\n@Component( {\n\tselector: \"cp-backup-exporter\",\n\ttemplate: require( \"./backup-exporter.component.html\" ),\n\tstyles: [ require( \"./backup-exporter.component.css\" ) ],\n} )\n\nexport class BackupExporterComponent implements OnDestroy {\n\n\texecutingBackup:boolean = false;\n\terrorMessages:Message[] = [];\n\tjobsService:JobsService;\n\texportSuccess:boolean;\n\tmonitorExecutionInterval:number;\n\n\t@Input() appContext:App.Context;\n\t@Input() backupJob:PersistedDocument.Class;\n\t@Output() onExportSuccess:EventEmitter<boolean> = new EventEmitter<boolean>();\n\n\tconstructor( jobsService:JobsService ) {\n\t\tthis.jobsService = jobsService;\n\t}\n\n\tonGenerateBackup():void {\n\t\tthis.executingBackup = true;\n\t\tthis.exportSuccess = false;\n\n\t\tthis.jobsService.runJob( this.backupJob ).then( ( execution:PersistedDocument.Class ) => {\n\t\t\treturn this.monitorExecution( execution ).catch( ( executionOrError:HTTPError|PersistedDocument.Class ) => {\n\t\t\t\tif( executionOrError.hasOwnProperty( \"response\" ) ) return Promise.reject( executionOrError );\n\t\t\t\tlet errorMessage:Message = <Message>{\n\t\t\t\t\ttitle: \"Couldn't execute backup.\",\n\t\t\t\t\tcontent: \"An error occurred while executing your export backup job. This may be caused due to a bad configuration during the creation of your job.\",\n\t\t\t\t\tstatusMessage: execution[ Job.Execution.ERROR_DESCRIPTION ]\n\t\t\t\t};\n\t\t\t\tthis.errorMessages.push( errorMessage );\n\t\t\t} );\n\t\t} ).then( () => {\n\t\t\tthis.exportSuccess = true;\n\t\t} ).catch( ( error:HTTPError ) => {\n\t\t\tlet errorMessage:Message = <Message>{\n\t\t\t\ttitle: error.name,\n\t\t\t\tcontent: \"Couldn't execute backup.\",\n\t\t\t\tendpoint: (<any>error.response.request).responseURL,\n\t\t\t\tstatusCode: \"\" + (<XMLHttpRequest>error.response.request).status,\n\t\t\t\tstatusMessage: (<XMLHttpRequest>error.response.request).statusText\n\t\t\t};\n\t\t\tthis.errorMessages.push( errorMessage );\n\t\t} ).then( () => {\n\t\t\tthis.executingBackup = false;\n\t\t} );\n\t}\n\n\tmonitorExecution( execution:PersistedDocument.Class ):Promise<PersistedDocument.Class> {\n\t\treturn new Promise<PersistedDocument.Class>( ( resolve:( result:any ) => void, reject:( error:HTTPError|PersistedDocument.Class ) => void ) => {\n\t\t\t// Node typings are overriding setInterval, that's why we need to cast it to any before assigning it to a number variable\n\t\t\tthis.monitorExecutionInterval = <any>setInterval( () => {\n\t\t\t\texecution.refresh().then( () => {\n\t\t\t\t\tswitch( execution[ Job.Execution.STATUS ].id ) {\n\t\t\t\t\t\tcase Job.ExecutionStatus.FINISHED:\n\t\t\t\t\t\t\tclearInterval( this.monitorExecutionInterval );\n\t\t\t\t\t\t\tresolve( execution );\n\t\t\t\t\t\t\tthis.onExportSuccess.emit( true );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase Job.ExecutionStatus.ERROR:\n\t\t\t\t\t\t\tclearInterval( this.monitorExecutionInterval );\n\t\t\t\t\t\t\treject( execution );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} ).catch( ( error:HTTPError ) => {\n\t\t\t\t\tlet errorMessage:Message = <Message>{\n\t\t\t\t\t\ttitle: error.name,\n\t\t\t\t\t\tcontent: \"Couldn't monitor the exporting backup status.\",\n\t\t\t\t\t\tendpoint: (<any>error.response.request).responseURL,\n\t\t\t\t\t\tstatusCode: \"\" + (<XMLHttpRequest>error.response.request).status,\n\t\t\t\t\t\tstatusMessage: (<XMLHttpRequest>error.response.request).statusText\n\t\t\t\t\t};\n\t\t\t\t\tthis.errorMessages = [ errorMessage ];\n\t\t\t\t\tclearInterval( this.monitorExecutionInterval );\n\t\t\t\t\tthis.executingBackup = false;\n\t\t\t\t} );\n\t\t\t}, 3000 );\n\t\t} );\n\t}\n\n\tngOnDestroy():void {\n\t\tif( typeof this.monitorExecutionInterval !== \"undefined\" ) clearInterval( this.monitorExecutionInterval );\n\t}\n\n\tremoveMessage( index:number ):void {\n\t\tthis.errorMessages.splice( index, 1 );\n\t}\n\n\tonCloseSuccess():void {\n\t\tthis.exportSuccess = false;\n\t}\n\n\tcloseMessage( messageDiv:HTMLElement ):void {\n\t\t$( messageDiv ).transition( { animation: \"fade\" } );\n\t}\n}\n\nexport default BackupExporterComponent;\n"]}