{"version":3,"sources":["my-apps/app-content/configuration/backup/backup-importer/backup-importer.component.ts"],"names":[],"mappings":"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","file":"backup-importer.component.js","sourcesContent":["import { Component, ElementRef, Input, OnInit, OnDestroy } from \"@angular/core\";\n\nimport * as App from \"carbonldp/App\";\nimport * as Response from \"carbonldp/HTTP/Response\";\nimport * as PersistedDocument from \"carbonldp/PersistedDocument\";\nimport * as Pointer from \"carbonldp/Pointer\";\nimport { Error as HTTPError } from \"carbonldp/HTTP/Errors\";\n\nimport { BackupsService } from \"../backups.service\";\nimport { JobsService } from \"../../job/jobs.service\";\nimport * as Job from \"../../job/job\";\nimport { Message } from \"./../../../../../errors-area/error-message.component\";\n\nimport \"semantic-ui/semantic\";\n\nimport template from \"./backup-importer.component.html!\";\nimport style from \"./backup-importer.component.css!text\";\n\n\n@Component( {\n\tselector: \"cp-backup-importer\",\n\ttemplate: template,\n\tstyles: [ style ],\n} )\n\nexport class BackupImporterComponent implements OnInit, OnDestroy {\n\t@Input() appContext:App.Context;\n\n\telement:ElementRef;\n\tmonitorExecutionInterval:number;\n\n\timportFormModel:{ uri:string, backup:string, backupFile:string } = {\n\t\turi: \"\",\n\t\tbackup: \"\",\n\t\tbackupFile: \"\",\n\t};\n\tbackupFileBlob:Blob;\n\tbackupFileArray:any[] = [];\n\n\tbackups:PersistedDocument.Class[] = [];\n\tbackupsService:BackupsService;\n\tjobsService:JobsService;\n\n\trunning:ImportStatus = new ImportStatus();\n\tuploading:ImportStatus = new ImportStatus();\n\tcreating:ImportStatus = new ImportStatus();\n\texecuting:ImportStatus = new ImportStatus();\n\terrorMessages:Message[] = [];\n\terrorMessage:Message;\n\n\tconstructor( element:ElementRef, backupsService:BackupsService, jobsService:JobsService ) {\n\t\tthis.element = element;\n\t\tthis.backupsService = backupsService;\n\t\tthis.jobsService = jobsService;\n\t}\n\n\tngOnInit():void {\n\t\tthis.getBackups();\n\t}\n\n\n\tgetBackups():void {\n\t\tthis.backupsService.getAll( this.appContext ).then( ( [ backups, response ]:[ PersistedDocument.Class[], Response.Class ] ) => {\n\t\t\tthis.backups = backups.sort( ( a:any, b:any ) => b.modified < a.modified ? - 1 : b.modified > a.modified ? 1 : 0 );\n\t\t} )\n\t}\n\n\tonImportBackup( form:any ):void {\n\t\tlet uri = form.form.controls.uri;\n\t\tlet backup = form.form.controls.backup;\n\t\tlet backupFile = form.form.controls.backupFile;\n\t\tthis.running.start();\n\t\tif( uri.valid ) this.createBackupImport( uri.value );\n\t\tif( backup.valid ) this.createBackupImport( backup.value );\n\t\tif( backupFile.valid ) this.uploadBackup( this.backupFileBlob );\n\t}\n\n\texecuteImport( importJob:PersistedDocument.Class ):Promise<PersistedDocument.Class> {\n\t\treturn this.jobsService.runJob( importJob );\n\t}\n\n\tmonitorExecution( importJobExecution:PersistedDocument.Class ):Promise<PersistedDocument.Class> {\n\t\treturn new Promise<PersistedDocument.Class>( ( resolve:( result:any ) => void, reject:( error:HTTPError|PersistedDocument.Class ) => void ) => {\n\t\t\t// Node typings are overriding setInterval, that's why we need to cast it to any before assigning it to a number variable\n\t\t\tthis.monitorExecutionInterval = <any>setInterval( () => {\n\t\t\t\tthis.checkImportJobExecution( importJobExecution ).then( () => {\n\t\t\t\t\tif( this.executing.done ) {\n\t\t\t\t\t\tclearInterval( this.monitorExecutionInterval );\n\t\t\t\t\t\tresolve( importJobExecution );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}, 3000 );\n\t\t} );\n\t}\n\n\tngOnDestroy():void {\n\t\tif( typeof this.monitorExecutionInterval !== \"undefined\" ) clearInterval( this.monitorExecutionInterval );\n\t}\n\n\tprivate checkImportJobExecution( importJobExecution:PersistedDocument.Class ):Promise<any> {\n\t\treturn this.jobsService.checkJobExecution( importJobExecution ).then( ( execution ) => {\n\t\t\tif( ! execution[ Job.Execution.STATUS ] ) return Promise.reject( execution );\n\t\t\tif( execution[ Job.Execution.STATUS ].id === Job.ExecutionStatus.FINISHED ) this.executing.success();\n\t\t\tif( execution[ Job.Execution.STATUS ].id === Job.ExecutionStatus.ERROR ) {\n\t\t\t\tthis.executing.fail();\n\t\t\t\tlet errorMessage:Message = <Message>{\n\t\t\t\t\ttitle: \"Error while executing import\",\n\t\t\t\t\tcontent: \"An error occurred while executing your import backup job. Please, fix your job configuration.\",\n\t\t\t\t\tstatusMessage: execution[ Job.Execution.ERROR_DESCRIPTION ]\n\t\t\t\t};\n\t\t\t\tthis.errorMessages.push( errorMessage );\n\t\t\t}\n\t\t} ).catch( ( error:HTTPError ) => {\n\t\t\tconsole.error( error );\n\t\t\tthis.executing.fail();\n\t\t\tlet errorMessage:Message;\n\t\t\tif( error.response ) errorMessage = this.getHTTPErrorMessage( error, \"Couldn't monitor the import execution.\" );\n\t\t\telse {\n\t\t\t\terrorMessage = <Message>{\n\t\t\t\t\ttitle: error.name,\n\t\t\t\t\tcontent: JSON.stringify( error )\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis.errorMessages.push( errorMessage );\n\t\t} )\n\t}\n\n\tonFileChange( event ):void {\n\t\tvar files:FileList = event.srcElement.files;\n\t\tthis.backupFileBlob = files[ 0 ];\n\t}\n\n\tonInputLostFocus( control:any ):void {\n\t\tswitch( control.name ) {\n\t\t\tcase \"uri\":\n\t\t\t\tif( control.valid ) {\n\t\t\t\t\tthis.element.nativeElement.querySelector( \"[ ng-reflect-name ='backup']\" ).setAttribute( \"disabled\", true );\n\t\t\t\t\tthis.element.nativeElement.querySelector( \"[ ng-reflect-name ='backupFile']\" ).setAttribute( \"disabled\", true );\n\t\t\t\t} else { this.enableAllInputs() }\n\t\t\t\tbreak;\n\t\t\tcase \"backup\":\n\t\t\t\tif( control.valid ) {\n\t\t\t\t\tthis.element.nativeElement.querySelector( \"[ ng-reflect-name ='uri']\" ).setAttribute( \"disabled\", true );\n\t\t\t\t\tthis.element.nativeElement.querySelector( \"[ ng-reflect-name ='backupFile']\" ).setAttribute( \"disabled\", true );\n\t\t\t\t} else { this.enableAllInputs() }\n\t\t\t\tbreak;\n\t\t\tcase \"backupFile\":\n\t\t\t\tif( ! ! this.backupFileBlob ) {\n\t\t\t\t\tthis.element.nativeElement.querySelector( \"[ ng-reflect-name ='uri']\" ).setAttribute( \"disabled\", true );\n\t\t\t\t\tthis.element.nativeElement.querySelector( \"[ ng-reflect-name='backup']\" ).setAttribute( \"disabled\", true );\n\t\t\t\t} else { this.enableAllInputs() }\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tenableAllInputs():void {\n\t\tthis.element.nativeElement.querySelector( \"[ng-reflect-name='uri']\" ).removeAttribute( \"disabled\", true );\n\t\tthis.element.nativeElement.querySelector( \"[ng-reflect-name='backupFile']\" ).removeAttribute( \"disabled\", true );\n\t}\n\n\tcanDisplayImportButtonLoading():boolean {\n\t\treturn this.uploading.active ? true : this.creating.active ? true : this.executing.active ? true : false;\n\t}\n\n\tuploadBackup( file:Blob ):void {\n\t\tthis.uploading.start();\n\t\tthis.backupsService.upload( file, this.appContext ).then(\n\t\t\t( [ pointer, response ]:[ Pointer.Class, Response.Class ] ) => {\n\t\t\t\tthis.uploading.success();\n\t\t\t\tthis.createBackupImport( pointer.id );\n\t\t\t}\n\t\t).catch( ( error:HTTPError ) => {\n\t\t\tconsole.error( error );\n\t\t\tthis.uploading.fail();\n\t\t\tlet errorMessage:Message;\n\t\t\tif( error.response ) errorMessage = this.getHTTPErrorMessage( error, \"Couldn't upload the file.\" );\n\t\t\telse {\n\t\t\t\terrorMessage = <Message>{\n\t\t\t\t\ttitle: error.name,\n\t\t\t\t\tcontent: JSON.stringify( error )\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis.errorMessages.push( errorMessage );\n\t\t} );\n\t}\n\n\tcreateBackupImport( backupURI:string ):Promise<any> {\n\t\tthis.creating.start();\n\t\treturn this.jobsService.createImportBackup( backupURI, this.appContext ).then( ( importJob:PersistedDocument.Class ) => {\n\t\t\tthis.creating.success();\n\t\t\tthis.executing.start();\n\t\t\treturn this.executeImport( importJob ).then( ( importJobExecution:PersistedDocument.Class ) => {this.monitorExecution( importJobExecution );}\n\t\t\t).catch( ( error:HTTPError ) => {\n\t\t\t\tconsole.error( error );\n\t\t\t\tthis.executing.fail();\n\t\t\t\tlet errorMessage:Message;\n\t\t\t\tif( error.response ) errorMessage = this.getHTTPErrorMessage( error, \"Couldn't monitor the import execution.\" );\n\t\t\t\telse {\n\t\t\t\t\terrorMessage = <Message>{\n\t\t\t\t\t\ttitle: error.name,\n\t\t\t\t\t\tcontent: JSON.stringify( error )\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tthis.errorMessages.push( errorMessage );\n\t\t\t} );\n\t\t} ).catch( ( error:HTTPError ) => {\n\t\t\tconsole.error( error );\n\t\t\tthis.creating.fail();\n\t\t\tlet errorMessage:Message;\n\t\t\tif( ! ! error.response ) errorMessage = this.getHTTPErrorMessage( error, \"The importing job couldn't be created.\" );\n\t\t\telse {\n\t\t\t\terrorMessage = <Message>{\n\t\t\t\t\ttitle: error.name,\n\t\t\t\t\tcontent: JSON.stringify( error )\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis.errorMessages.push( errorMessage );\n\t\t} );\n\t}\n\n\tprivate getHTTPErrorMessage( error:HTTPError, content:string ):Message {\n\t\treturn {\n\t\t\ttitle: error.name,\n\t\t\tcontent: content + \" Reason: \" + error.message,\n\t\t\tendpoint: (<any>error.response.request).responseURL,\n\t\t\tstatusCode: \"\" + (<XMLHttpRequest>error.response.request).status + \" - RequestID: \" + error.requestID,\n\t\t\tstatusMessage: (<XMLHttpRequest>error.response.request).statusText\n\t\t};\n\t}\n\n\tfinishImport():void {\n\t\tthis.uploading = new ImportStatus();\n\t\tthis.creating = new ImportStatus();\n\t\tthis.executing = new ImportStatus();\n\t\tthis.running = new ImportStatus();\n\t\tthis.getBackups();\n\t\tthis.errorMessages = [];\n\t}\n\n\tcheckForFailedTasks():boolean {\n\t\treturn this.uploading.failed ? true : this.creating.failed ? true : this.executing.failed ? true : false;\n\t}\n\n\tremoveMessage( index:number ):void {\n\t\tthis.errorMessages.splice( index, 1 );\n\t}\n}\n\nexport class ImportStatus {\n\tprivate _active:boolean;\n\tprivate _done:boolean;\n\tprivate _failed:boolean;\n\tprivate _succeed:boolean;\n\n\tget active():boolean { return this._active; }\n\n\tget done():boolean { return this._done; }\n\n\tget failed():boolean { return this._failed; }\n\n\tget succeed():boolean { return this._succeed; }\n\n\tset active( value:boolean ) {\n\t\tthis._active = value;\n\t\tthis._done = ! value;\n\t}\n\n\tset done( value:boolean ) {\n\t\tthis._done = value;\n\t\tthis._active = ! value;\n\t}\n\n\tset failed( value:boolean ) {\n\t\tthis.done = true;\n\t\tthis._failed = value;\n\t\tthis._succeed = ! value;\n\t}\n\n\tset succeed( value:boolean ) {\n\t\tthis.done = true;\n\t\tthis._failed = ! value;\n\t\tthis._succeed = value;\n\t}\n\n\tstart():void {\n\t\tthis.active = true;\n\t}\n\n\tfinish():void {\n\t\tthis.done = true;\n\t}\n\n\tfail():void {\n\t\tthis.failed = true;\n\t}\n\n\tsuccess():void {\n\t\tthis.succeed = true;\n\t}\n}\nexport default BackupImporterComponent;"]}