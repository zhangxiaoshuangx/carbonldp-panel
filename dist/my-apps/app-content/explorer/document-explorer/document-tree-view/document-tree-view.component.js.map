{"version":3,"sources":["my-apps/app-content/explorer/document-explorer/document-tree-view/document-tree-view.component.ts"],"names":[],"mappings":"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","file":"my-apps/app-content/explorer/document-explorer/document-tree-view/document-tree-view.component.js","sourcesContent":["import { Component, ElementRef, Input, Output, EventEmitter, AfterViewInit, OnInit } from \"@angular/core\";\n\nimport * as Pointer from \"carbonldp/Pointer\";\nimport * as PersistedDocument from \"carbonldp/PersistedDocument\";\nimport * as HTTP from \"carbonldp/HTTP\";\nimport * as URI from \"carbonldp/RDF/URI\";\nimport * as SDKContext from \"carbonldp/SDKContext\";\nimport * as RDFDocument from \"carbonldp/RDF/Document\";\n\nimport $ from \"jquery\";\nimport \"semantic-ui/semantic\";\n\nimport \"jstree/dist/jstree.min\";\nimport \"jstree/dist/themes/default/style.min.css!\";\n\nimport template from \"./document-tree-view.component.html!\";\nimport style from \"./document-tree-view.component.css!text\";\n\n@Component( {\n\tselector: \"cp-document-treeview\",\n\ttemplate: template,\n\tstyles: [ style ],\n} )\n\nexport class DocumentTreeViewComponent implements AfterViewInit {\n\telement:ElementRef;\n\t$element:JQuery;\n\n\tdocumentTree:JQuery;\n\tnodeChildren:any[] = [];\n\n\t@Input() documentContext:SDKContext.Class;\n\t@Output() onResolveUri:EventEmitter<RDFDocument.Class> = new EventEmitter<RDFDocument.Class>();\n\t@Output() onError:EventEmitter<HTTP.Errors.Error> = new EventEmitter<HTTP.Errors.Error>();\n\t@Output() onLoadingDocument:EventEmitter<boolean> = new EventEmitter<boolean>();\n\n\tconstructor( element:ElementRef ) {\n\t\tthis.element = element;\n\t}\n\n\tngAfterViewInit():void {\n\t\tthis.$element = $( this.element.nativeElement );\n\t\tthis.documentTree = this.$element.find( \".document.treeview\" );\n\t\tthis.onLoadingDocument.emit( true );\n\t\tthis.getDocumentTree().then( ()=> {\n\t\t\tthis.onLoadingDocument.emit( false );\n\t\t} );\n\t}\n\n\tgetDocumentTree():Promise<PersistedDocument.Class> {\n\t\treturn this.documentContext.documents.get( \"\" ).then( ( [ resolvedRoot, response ]:[ PersistedDocument.Class, HTTP.Response.Class ] ) => {\n\t\t\treturn resolvedRoot.refresh();\n\t\t} ).then( ( [updatedRoot, updatedResponse]:[PersistedDocument.Class, HTTP.Response.Class] ) => {\n\t\t\tthis.nodeChildren.push( this.buildNode( this.documentContext.getBaseURI() ) );\n\t\t\tthis.renderTree();\n\t\t} ).catch( ( error:HTTP.Errors.Error ) => {\n\t\t\tconsole.error( error );\n\t\t\tthis.onError.emit( error );\n\t\t} );\n\t}\n\n\tbuildNode( uri:string ):any {\n\t\treturn {\n\t\t\t\"text\": this.getSlug( uri ),\n\t\t\t\"state\": { \"opened\": false },\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"text\": \"Loading...\",\n\t\t\t\t},\n\t\t\t],\n\t\t\t\"data\": {\n\t\t\t\t\"pointer\": {\n\t\t\t\t\t\"id\": uri,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\trenderTree():void {\n\t\tthis.documentTree.jstree( {\n\t\t\t\"core\": {\n\t\t\t\t\"data\": this.nodeChildren,\n\t\t\t\t\"check_callback\": true,\n\t\t\t},\n\t\t\t\"types\": {\n\t\t\t\t\"default\": {\n\t\t\t\t\t\"icon\": \"file outline icon\",\n\t\t\t\t},\n\t\t\t\t\"loading\": {\n\t\t\t\t\t\"icon\": \"spinner loading icon\",\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"plugins\": [ \"types\", \"wholerow\" ],\n\t\t} );\n\t\tthis.documentTree.jstree();\n\t\tthis.documentTree.on( \"create_node.jstree\", ( e:Event, data:any ):void => {} );\n\t\tthis.documentTree.on( \"before_open.jstree\", ( e:Event, data:any ):void => {\n\t\t\tlet parentId:any = data.node.id;\n\t\t\tlet parentNode:any = data.node;\n\t\t\tlet position:string = \"last\";\n\t\t\tthis.onBeforeOpenNode( parentId, parentNode, position );\n\t\t} );\n\t\tthis.documentTree.on( \"changed.jstree\", ( e:Event, data:any ):void => {\n\t\t\tlet parentId:any = data.node.id;\n\t\t\tlet parentNode:any = data.node;\n\t\t\tlet position:string = \"last\";\n\t\t\tthis.onClickNode( parentId, parentNode, position );\n\t\t} );\n\t\tthis.documentTree.on( \"loaded.jstree\", ()=> {\n\t\t\tthis.documentTree.jstree( \"open_all\" );\n\t\t\tif( this.nodeChildren && this.nodeChildren.length > 0 ) {\n\t\t\t\tthis.onResolveUri.emit( this.nodeChildren[ 0 ].data.pointer.id );\n\t\t\t}\n\t\t} );\n\t}\n\n\temptyNode( nodeId:string ):void {\n\t\tlet $children:JQuery = this.documentTree.jstree( true ).get_children_dom( nodeId );\n\t\tlet childElements:Element[] = jQuery.makeArray( $children );\n\t\twhile( childElements.length > 0 ) {\n\t\t\tthis.documentTree.jstree( true ).delete_node( childElements[ 0 ] );\n\t\t\tchildElements.splice( 0, 1 );\n\t\t}\n\t}\n\n\tonBeforeOpenNode( parentId:string, parentNode:any, position:string ):void {\n\t\tlet oldIcon:string = parentNode.icon;\n\t\tlet $documentTree:JSTree = this.documentTree.jstree( true );\n\n\t\t$documentTree.set_icon( parentNode, $documentTree.settings.types.loading.icon );\n\t\tthis.getNodeChildren( parentNode.data.pointer.id ).then( ( children:any[] ):void => {\n\t\t\tthis.emptyNode( parentId );\n\t\t\tif( children.length > 0 ) {\n\t\t\t\tchildren.forEach( ( childNode:any ) => this.addChild( parentId, childNode, position ) );\n\t\t\t}\n\t\t} ).then( () => {\n\t\t\t$documentTree.set_icon( parentNode, oldIcon );\n\t\t} );\n\t}\n\n\tonClickNode( parentId:string, node:any, position:string ):void {\n\t\tlet tree:JSTree = this.documentTree.jstree( true );\n\t\tif( tree.is_open( node ) ) {\n\t\t\tthis.onBeforeOpenNode( parentId, node, position );\n\t\t} else {\n\t\t\ttree.open_node( node );\n\t\t}\n\t\tthis.onResolveUri.emit( node.data.pointer.id );\n\t}\n\n\taddChild( parentId:string, node:any, position:string ):void {\n\t\tthis.documentTree.jstree( true ).create_node( parentId, node, position );\n\t}\n\n\tgetNodeChildren( uri:string ):Promise<any[]> {\n\t\treturn this.documentContext.documents.get( uri ).then( ( [resolvedRoot, response]:[PersistedDocument.Class, HTTP.Response.Class] ) => {\n\t\t\treturn resolvedRoot.refresh().then( ( [refreshedRoot, response]:[PersistedDocument.Class, HTTP.Response.Class] )=> {\n\t\t\t\tif( ! resolvedRoot.contains ) return [];\n\t\t\t\treturn resolvedRoot.contains.map( ( pointer:Pointer.Class ):void => {\n\t\t\t\t\treturn this.buildNode( pointer.id );\n\t\t\t\t} );\n\t\t\t} );\n\t\t} ).catch( ( error ) => {\n\t\t\tconsole.error( error );\n\t\t\treturn [];\n\t\t} );\n\t}\n\n\n\tgetSlug( pointer:Pointer.Class | string ):string {\n\t\tif( typeof pointer !== \"string\" ) return ( <Pointer.Class>pointer ).id;\n\n\t\treturn URI.Util.getSlug( <string>pointer );\n\t}\n\n}\n\nexport default DocumentTreeViewComponent;"],"sourceRoot":"/source/"}