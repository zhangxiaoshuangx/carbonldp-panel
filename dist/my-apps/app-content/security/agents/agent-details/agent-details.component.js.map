{"version":3,"sources":["my-apps/app-content/security/agents/agent-details/agent-details.component.ts"],"names":[],"mappings":"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","file":"agent-details.component.js","sourcesContent":["import { ElementRef, Component, Input, Output, EventEmitter, AfterViewInit, OnChanges, SimpleChanges, SimpleChange } from \"@angular/core\";\n\nimport * as App from \"carbonldp/App\";\nimport * as Agent from \"carbonldp/Auth/Agent\";\nimport * as PersistedRole from \"carbonldp/Auth/PersistedRole\";\nimport * as PersistedAgent from \"carbonldp/Auth/PersistedAgent\";\nimport * as HTTP from \"carbonldp/HTTP\";\nimport * as RDF from \"carbonldp/RDF\";\n\nimport { AgentsService } from \"../agents.service\";\nimport { RolesService } from \"../../roles/roles.service\";\nimport { DocumentExplorerLibrary } from \"carbonldp-panel/document-explorer/document-explorer-library\";\nimport { Message } from \"carbonldp-panel/errors-area/error-message.component\";\nimport { ErrorMessageGenerator } from \"carbonldp-panel/errors-area/error-message-generator\";\n\nimport template from \"./agent-details.component.html!\";\nimport style from \"./agent-details.component.css!text\";\n\n@Component( {\n\tselector: \"cp-agent-details\",\n\ttemplate: template,\n\tstyles: [ style ],\n} )\n\nexport class AgentDetailsComponent implements OnChanges {\n\n\tprivate element:ElementRef;\n\tprivate $element:JQuery;\n\n\tprivate timer:number;\n\tprivate Modes:Modes = Modes;\n\tprivate agentRoles:PersistedRole.Class[] = [];\n\tprivate availableRoles:string[] = [];\n\tprivate errorMessage:Message;\n\tprivate displaySuccessMessage:boolean = false;\n\n\tprivate agentsService:AgentsService;\n\tprivate rolesService:RolesService;\n\n\t@Input() mode:string = Modes.READ;\n\t@Input() agent:PersistedAgent.Class;\n\t@Input() appContext:App.Context;\n\t@Input() canClose:boolean = true;\n\n\t@Output() onClose:EventEmitter<boolean> = new EventEmitter<boolean>();\n\t@Output() onSuccess:EventEmitter<boolean> = new EventEmitter<boolean>();\n\t@Output() onError:EventEmitter<boolean> = new EventEmitter<boolean>();\n\n\tprivate agentFormModel:AgentFormModel = {\n\t\tslug: \"\",\n\t\tname: \"\",\n\t\temail: \"\",\n\t\troles: [],\n\t\tpassword: \"\",\n\t\trepeatPassword: \"\",\n\t\tenabled: false,\n\t};\n\n\tconstructor( element:ElementRef, agentsService:AgentsService, rolesService:RolesService ) {\n\t\tthis.element = element;\n\t\tthis.$element = $( element.nativeElement );\n\t\tthis.agentsService = agentsService;\n\t\tthis.rolesService = rolesService;\n\t}\n\n\tngAfterViewInit():void {\n\t\tthis.getRoles( this.agent ).then( ( roles:PersistedRole.Class[] ) => {\n\t\t\troles.forEach( ( role:PersistedRole.Class ) => {\n\t\t\t\tthis.availableRoles.push( role.id );\n\t\t\t} );\n\t\t} );\n\t\tthis.$element.find( \".enabled.checkbox\" ).checkbox();\n\t}\n\n\tngOnChanges( changes:SimpleChanges ):void {\n\t\tif( ! ! changes[ \"agent\" ] && changes[ \"agent\" ].currentValue !== changes[ \"agent\" ].previousValue ) {\n\t\t\tif( this.mode === Modes.CREATE && ! this.agent ) {\n\t\t\t\tthis.agent = <Agent.Class & PersistedAgent.Class>Agent.Factory.create( \"New Agent Name\", \"new-agent@mail.com\", \"password\" );\n\t\t\t}\n\t\t\tthis.changeAgent( this.agent );\n\t\t}\n\t}\n\n\tprivate changeAgent( newAgent:PersistedAgent.Class ):void {\n\t\tthis.agent = newAgent;\n\t\tlet agentSlug:string = RDF.URI.Util.getSlug( this.agent.id );\n\t\tif( this.mode === Modes.CREATE ) {\n\t\t\tagentSlug = \"new-agent-name\";\n\t\t}\n\n\t\tthis.agentFormModel.slug = this.getSanitizedSlug( agentSlug );\n\t\tthis.agentFormModel.name = this.agent.name;\n\t\tthis.agentFormModel.email = this.agent.email;\n\t\tthis.agentFormModel.roles = [];\n\t\tthis.agentFormModel.password = \"\";\n\t\tthis.agentFormModel.repeatPassword = \"\";\n\t\tthis.agentFormModel.enabled = this.mode === Modes.CREATE ? true : this.agent.enabled;\n\t\tthis.getRoles( this.agent ).then( ( roles:PersistedRole.Class[] ) => {\n\t\t\troles.forEach( ( role:PersistedRole.Class ) => {\n\t\t\t\tthis.agentFormModel.roles.push( role.id );\n\t\t\t} );\n\t\t\tthis.agentRoles = roles;\n\t\t} );\n\t}\n\n\tprivate getRoles():Promise<PersistedRole.Class[]>;\n\tprivate getRoles( agent?:PersistedAgent.Class ):Promise<PersistedRole.Class[]>;\n\tprivate getRoles( agent?:any ):Promise<PersistedRole.Class[]> {\n\t\tif( ! agent ) return this.rolesService.getAll( this.appContext );\n\t\treturn this.rolesService.getAll( this.appContext ).then( ( appRoles:PersistedRole.Class[] ) => {\n\t\t\treturn appRoles.filter( ( role:any ) => {\n\t\t\t\treturn ! role.agents ? false : role.agents.some( ( listedAgent:Agent.Class ) => {return listedAgent.id === agent.id } );\n\t\t\t} );\n\t\t} );\n\t}\n\n\tprivate changeMode( mode:string ) {\n\t\tthis.mode = mode;\n\t}\n\n\tprivate changeRoles( selectedRoles:PersistedRole.Class[] ):void {\n\t\tthis.agentFormModel.roles = [];\n\t\tselectedRoles.forEach( ( selectedRole:PersistedRole.Class ) => {\n\t\t\tthis.agentFormModel.roles.push( selectedRole.id );\n\t\t} );\n\t}\n\n\tprivate cancelForm():void {\n\t\tthis.changeAgent( this.agent );\n\t\tif( this.mode === Modes.CREATE ) {\n\t\t\tthis.close();\n\t\t} else {\n\t\t\tthis.mode = Modes.READ;\n\t\t}\n\t}\n\n\tprivate onSubmit( data:AgentFormModel, $event:any ):void {\n\t\t$event.preventDefault();\n\t\tswitch( this.mode ) {\n\t\t\tcase Modes.EDIT:\n\t\t\t\tthis.editAgent( this.agent, data );\n\t\t\t\tbreak;\n\t\t\tcase Modes.CREATE:\n\t\t\t\tthis.createAgent( this.agent, data );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate editAgent( agent:PersistedAgent.Class, agentData:AgentFormModel ):void {\n\t\tagent.email = agentData.email;\n\t\tagent.name = agentData.name;\n\t\tagent.password = agentData.password.trim().length > 0 ? agentData.password : agent.password;\n\t\tagent.enabled = agentData.enabled;\n\t\tthis.agentsService.saveAndRefreshAgent( this.appContext, agent ).then( ( [ updatedAgent, [ saveResponse, refreshResponse ] ]:[ PersistedAgent.Class, [ HTTP.Response.Class, HTTP.Response.Class ] ] ) => {\n\t\t\treturn this.editAgentRoles( agent, agentData.roles );\n\t\t} ).then( () => {\n\t\t\tthis.displaySuccessMessage = true;\n\t\t\tthis.onSuccess.emit( true );\n\t\t\tthis.cancelForm();\n\t\t} ).catch( ( error ) => {\n\t\t\tthis.errorMessage = ErrorMessageGenerator.getErrorMessage( error );\n\t\t\tif( typeof error.name !== \"undefined\" ) this.errorMessage.title = error.name;\n\t\t\tthis.onError.emit( true );\n\t\t} );\n\t}\n\n\tprivate createAgent( agent:PersistedAgent.Class, agentData:AgentFormModel ):void {\n\t\tagent.email = agentData.email;\n\t\tagent.name = agentData.name;\n\t\tagent.password = agentData.password;\n\t\tagent.enabled = agentData.enabled;\n\t\tthis.agentsService.createAgent( this.appContext, <any>agent, agentData.slug ).then( ( [ updatedAgent, response ]:[ PersistedAgent.Class, HTTP.Response.Class ] ) => {\n\t\t\treturn this.editAgentRoles( agent, agentData.roles );\n\t\t} ).then( () => {\n\t\t\tthis.displaySuccessMessage = true;\n\t\t\tthis.emitOnSuccessAfter( 5 );\n\t\t} ).catch( ( error ) => {\n\t\t\tthis.errorMessage = ErrorMessageGenerator.getErrorMessage( error );\n\t\t\tif( typeof error.name !== \"undefined\" ) this.errorMessage.title = error.name;\n\t\t\tthis.onError.emit( true );\n\t\t} );\n\t}\n\n\tprivate emitOnSuccessAfter( seconds:number ):void {\n\t\tthis.timer = seconds;\n\t\tlet countDown:any = setInterval( ():boolean => {\n\t\t\tthis.timer --;\n\t\t\tif( this.timer === 0 ) {\n\t\t\t\tthis.onSuccess.emit( true );\n\t\t\t\tthis.timer = null;\n\t\t\t\tclearInterval( countDown );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}, 1000 );\n\t}\n\n\tprivate getSanitizedSlug( slug:string ):string {\n\t\treturn DocumentExplorerLibrary.getSanitizedSlug( slug );\n\t}\n\n\tprivate slugLostFocus( evt:any ):void {\n\t\tevt.target.value = DocumentExplorerLibrary.getAppendedSlashSlug( evt.target.value );\n\t}\n\n\tprivate editAgentRoles( agent:PersistedAgent.Class, selectedRoles:string[] ):Promise<any> {\n\t\tlet removedRoles:string[] = this.getRemovedRoles( selectedRoles ),\n\t\t\tpromises:Promise<any>[] = [];\n\n\t\tselectedRoles.forEach( ( roleID:string, idx:number, roles:string[] ) => {\n\t\t\tpromises.push( this.registerAgentToRole( agent.id, roleID ) )\n\t\t} );\n\t\tremovedRoles.forEach( ( roleID:string, idx:number, roles:string[] ) => {\n\t\t\tpromises.push( this.removeAgentFromRole( agent.id, roleID ) )\n\t\t} );\n\n\t\treturn Promise.all( promises ).catch( ( error ) => {\n\t\t\tlet generatedMessage:Message = ErrorMessageGenerator.getErrorMessage( error ),\n\t\t\t\tfinalError:Error = new Error( \"The agent was saved but an error occurred while trying to persist its roles: \" + generatedMessage.content );\n\t\t\tfinalError.name = \"Agent Saved\";\n\t\t\tthrow finalError;\n\t\t} );\n\t}\n\n\tprivate getRemovedRoles( selectedRoles:string[] ):string[] {\n\t\treturn this.agentRoles.filter( ( agentRole:PersistedRole.Class ) => {\n\t\t\treturn ! selectedRoles.some( ( selectedRole:string ) => {\n\t\t\t\treturn selectedRole === agentRole.id;\n\t\t\t} );\n\t\t} ).map( ( removedRole:PersistedRole.Class ) => {\n\t\t\treturn removedRole.id\n\t\t} );\n\t}\n\n\tprivate registerAgentToRole( agentID:string, roleID:string ):Promise<HTTP.Response.Class> {\n\t\treturn this.rolesService.registerAgent( this.appContext, agentID, roleID );\n\t}\n\n\tprivate removeAgentFromRole( agentID:string, roleID:string ):Promise<HTTP.Response.Class> {\n\t\treturn this.rolesService.removeAgent( this.appContext, agentID, roleID );\n\t}\n\n\tprivate close():void {\n\t\tthis.onClose.emit( true );\n\t}\n\n\tprivate closeError():void {\n\t\tthis.errorMessage = null;\n\t}\n\n\tprivate closeSuccessMessage( event:Event, messageDiv:HTMLElement ):void {\n\t\t$( messageDiv ).transition( {\n\t\t\tanimation: \"fade\",\n\t\t\tonComplete: () => { this.displaySuccessMessage = false; }\n\t\t} );\n\t}\n}\n\nexport class Modes {\n\tstatic READ:string = \"READ\";\n\tstatic EDIT:string = \"EDIT\";\n\tstatic CREATE:string = \"CREATE\";\n}\n\nexport interface AgentFormModel {\n\tslug:string;\n\tname:string;\n\temail:string;\n\troles:string[];\n\tpassword:string;\n\trepeatPassword:string;\n\tenabled:boolean;\n}\n\nexport default AgentDetailsComponent;"]}