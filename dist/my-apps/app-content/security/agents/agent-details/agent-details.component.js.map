{"version":3,"sources":["my-apps/app-content/security/agents/agent-details/agent-details.component.ts"],"names":[],"mappings":"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","file":"agent-details.component.js","sourcesContent":["import { ElementRef, Component, Input, Output, EventEmitter, AfterViewInit, OnChanges, SimpleChanges, SimpleChange } from \"@angular/core\";\n\nimport * as App from \"carbonldp/App\";\nimport * as Agent from \"carbonldp/Auth/Agent\";\nimport * as PersistedRole from \"carbonldp/Auth/PersistedRole\";\nimport * as PersistedAgent from \"carbonldp/Auth/PersistedAgent\";\nimport * as HTTP from \"carbonldp/HTTP\";\nimport * as RDF from \"carbonldp/RDF\";\n\nimport { AgentsService } from \"../agents.service\";\nimport { RolesService } from \"../../roles/roles.service\";\nimport { DocumentExplorerLibrary } from \"carbonldp-panel/document-explorer/document-explorer-library\";\nimport { Message } from \"carbonldp-panel/errors-area/error-message.component\";\nimport { ErrorMessageGenerator } from \"carbonldp-panel/errors-area/error-message-generator\";\n\n@Component( {\n\tselector: \"cp-agent-details\",\n\ttemplate: require( \"./agent-details.component.html\" ),\n\tstyles: [ require( \"./agent-details.component.css\" ) ],\n} )\n\nexport class AgentDetailsComponent implements OnChanges {\n\n\tprivate element:ElementRef;\n\tprivate $element:JQuery;\n\n\tprivate timer:number;\n\tprivate Modes:Modes = Modes;\n\tprivate agentRoles:PersistedRole.Class[] = [];\n\tprivate availableRoles:string[] = [];\n\tprivate errorMessage:Message;\n\tprivate displaySuccessMessage:boolean = false;\n\n\tprivate agentsService:AgentsService;\n\tprivate rolesService:RolesService;\n\n\t@Input() mode:string = Modes.READ;\n\t@Input() agent:PersistedAgent.Class;\n\t@Input() appContext:App.Context;\n\t@Input() canClose:boolean = true;\n\n\t@Output() onClose:EventEmitter<boolean> = new EventEmitter<boolean>();\n\t@Output() onSuccess:EventEmitter<boolean> = new EventEmitter<boolean>();\n\t@Output() onError:EventEmitter<boolean> = new EventEmitter<boolean>();\n\n\tprivate agentFormModel:AgentFormModel = {\n\t\tslug: \"\",\n\t\tname: \"\",\n\t\temail: \"\",\n\t\troles: [],\n\t\tpassword: \"\",\n\t\trepeatPassword: \"\",\n\t\tenabled: false,\n\t};\n\n\tconstructor( element:ElementRef, agentsService:AgentsService, rolesService:RolesService ) {\n\t\tthis.element = element;\n\t\tthis.$element = $( element.nativeElement );\n\t\tthis.agentsService = agentsService;\n\t\tthis.rolesService = rolesService;\n\t}\n\n\tngAfterViewInit():void {\n\t\tthis.getRoles( this.agent ).then( ( roles:PersistedRole.Class[] ) => {\n\t\t\troles.forEach( ( role:PersistedRole.Class ) => {\n\t\t\t\tthis.availableRoles.push( role.id );\n\t\t\t} );\n\t\t} );\n\t\tthis.$element.find( \".enabled.checkbox\" ).checkbox();\n\t}\n\n\tngOnChanges( changes:SimpleChanges ):void {\n\t\tif( ! ! changes[ \"agent\" ] && changes[ \"agent\" ].currentValue !== changes[ \"agent\" ].previousValue ) {\n\t\t\tif( this.mode === Modes.CREATE && ! this.agent ) {\n\t\t\t\tthis.agent = <Agent.Class & PersistedAgent.Class>Agent.Factory.create( \"New Agent Name\", \"new-agent@mail.com\", \"password\" );\n\t\t\t}\n\t\t\tthis.changeAgent( this.agent );\n\t\t}\n\t}\n\n\tprivate changeAgent( newAgent:PersistedAgent.Class ):void {\n\t\tthis.agent = newAgent;\n\t\tlet agentSlug:string = RDF.URI.Util.getSlug( this.agent.id );\n\t\tif( this.mode === Modes.CREATE ) {\n\t\t\tagentSlug = \"new-agent-name\";\n\t\t}\n\n\t\tthis.agentFormModel.slug = this.getSanitizedSlug( agentSlug );\n\t\tthis.agentFormModel.name = this.agent.name;\n\t\tthis.agentFormModel.email = this.agent.email;\n\t\tthis.agentFormModel.roles = [];\n\t\tthis.agentFormModel.password = \"\";\n\t\tthis.agentFormModel.repeatPassword = \"\";\n\t\tthis.agentFormModel.enabled = this.mode === Modes.CREATE ? true : this.agent.enabled;\n\t\tthis.getRoles( this.agent ).then( ( roles:PersistedRole.Class[] ) => {\n\t\t\troles.forEach( ( role:PersistedRole.Class ) => {\n\t\t\t\tthis.agentFormModel.roles.push( role.id );\n\t\t\t} );\n\t\t\tthis.agentRoles = roles;\n\t\t} );\n\t}\n\n\tprivate getRoles():Promise<PersistedRole.Class[]>;\n\tprivate getRoles( agent?:PersistedAgent.Class ):Promise<PersistedRole.Class[]>;\n\tprivate getRoles( agent?:any ):Promise<PersistedRole.Class[]> {\n\t\tif( ! agent ) return this.rolesService.getAll( this.appContext );\n\t\treturn this.rolesService.getAll( this.appContext ).then( ( appRoles:PersistedRole.Class[] ) => {\n\t\t\treturn appRoles.filter( ( role:any ) => {\n\t\t\t\treturn ! role.agents ? false : role.agents.some( ( listedAgent:Agent.Class ) => {return listedAgent.id === agent.id } );\n\t\t\t} );\n\t\t} );\n\t}\n\n\tprivate changeMode( mode:string ) {\n\t\tthis.mode = mode;\n\t}\n\n\tprivate changeRoles( selectedRoles:PersistedRole.Class[] ):void {\n\t\tthis.agentFormModel.roles = [];\n\t\tselectedRoles.forEach( ( selectedRole:PersistedRole.Class ) => {\n\t\t\tthis.agentFormModel.roles.push( selectedRole.id );\n\t\t} );\n\t}\n\n\tprivate cancelForm():void {\n\t\tthis.changeAgent( this.agent );\n\t\tif( this.mode === Modes.CREATE ) {\n\t\t\tthis.close();\n\t\t} else {\n\t\t\tthis.mode = Modes.READ;\n\t\t}\n\t}\n\n\tprivate onSubmit( data:AgentFormModel, $event:any ):void {\n\t\t$event.preventDefault();\n\t\tswitch( this.mode ) {\n\t\t\tcase Modes.EDIT:\n\t\t\t\tthis.editAgent( this.agent, data );\n\t\t\t\tbreak;\n\t\t\tcase Modes.CREATE:\n\t\t\t\tthis.createAgent( this.agent, data );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate editAgent( agent:PersistedAgent.Class, agentData:AgentFormModel ):void {\n\t\tagent.email = agentData.email;\n\t\tagent.name = agentData.name;\n\t\tagent.password = agentData.password.trim().length > 0 ? agentData.password : agent.password;\n\t\tagent.enabled = agentData.enabled;\n\t\tthis.agentsService.saveAndRefreshAgent( this.appContext, agent ).then( ( [ updatedAgent, [ saveResponse, refreshResponse ] ]:[ PersistedAgent.Class, [ HTTP.Response.Class, HTTP.Response.Class ] ] ) => {\n\t\t\treturn this.editAgentRoles( agent, agentData.roles );\n\t\t} ).then( () => {\n\t\t\tthis.displaySuccessMessage = true;\n\t\t\tthis.onSuccess.emit( true );\n\t\t\tthis.cancelForm();\n\t\t} ).catch( ( error ) => {\n\t\t\tthis.errorMessage = ErrorMessageGenerator.getErrorMessage( error );\n\t\t\tif( typeof error.name !== \"undefined\" ) this.errorMessage.title = error.name;\n\t\t\tthis.onError.emit( true );\n\t\t} );\n\t}\n\n\tprivate createAgent( agent:PersistedAgent.Class, agentData:AgentFormModel ):void {\n\t\tagent.email = agentData.email;\n\t\tagent.name = agentData.name;\n\t\tagent.password = agentData.password;\n\t\tagent.enabled = agentData.enabled;\n\t\tthis.agentsService.createAgent( this.appContext, <any>agent, agentData.slug ).then( ( [ updatedAgent, response ]:[ PersistedAgent.Class, HTTP.Response.Class ] ) => {\n\t\t\treturn this.editAgentRoles( agent, agentData.roles );\n\t\t} ).then( () => {\n\t\t\tthis.displaySuccessMessage = true;\n\t\t\tthis.emitOnSuccessAfter( 5 );\n\t\t} ).catch( ( error ) => {\n\t\t\tthis.errorMessage = ErrorMessageGenerator.getErrorMessage( error );\n\t\t\tif( typeof error.name !== \"undefined\" ) this.errorMessage.title = error.name;\n\t\t\tthis.onError.emit( true );\n\t\t} );\n\t}\n\n\tprivate emitOnSuccessAfter( seconds:number ):void {\n\t\tthis.timer = seconds;\n\t\tlet countDown:any = setInterval( ():boolean => {\n\t\t\tthis.timer --;\n\t\t\tif( this.timer === 0 ) {\n\t\t\t\tthis.onSuccess.emit( true );\n\t\t\t\tthis.timer = null;\n\t\t\t\tclearInterval( countDown );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}, 1000 );\n\t}\n\n\tprivate getSanitizedSlug( slug:string ):string {\n\t\treturn DocumentExplorerLibrary.getSanitizedSlug( slug );\n\t}\n\n\tprivate slugLostFocus( evt:any ):void {\n\t\tevt.target.value = DocumentExplorerLibrary.getAppendedSlashSlug( evt.target.value );\n\t}\n\n\tprivate editAgentRoles( agent:PersistedAgent.Class, selectedRoles:string[] ):Promise<any> {\n\t\tlet removedRoles:string[] = this.getRemovedRoles( selectedRoles ),\n\t\t\tpromises:Promise<any>[] = [];\n\n\t\tselectedRoles.forEach( ( roleID:string, idx:number, roles:string[] ) => {\n\t\t\tpromises.push( this.registerAgentToRole( agent.id, roleID ) )\n\t\t} );\n\t\tremovedRoles.forEach( ( roleID:string, idx:number, roles:string[] ) => {\n\t\t\tpromises.push( this.removeAgentFromRole( agent.id, roleID ) )\n\t\t} );\n\n\t\treturn Promise.all( promises ).catch( ( error ) => {\n\t\t\tlet generatedMessage:Message = ErrorMessageGenerator.getErrorMessage( error ),\n\t\t\t\tfinalError:Error = new Error( \"The agent was saved but an error occurred while trying to persist its roles: \" + generatedMessage.content );\n\t\t\tfinalError.name = \"Agent Saved\";\n\t\t\tthrow finalError;\n\t\t} );\n\t}\n\n\tprivate getRemovedRoles( selectedRoles:string[] ):string[] {\n\t\treturn this.agentRoles.filter( ( agentRole:PersistedRole.Class ) => {\n\t\t\treturn ! selectedRoles.some( ( selectedRole:string ) => {\n\t\t\t\treturn selectedRole === agentRole.id;\n\t\t\t} );\n\t\t} ).map( ( removedRole:PersistedRole.Class ) => {\n\t\t\treturn removedRole.id\n\t\t} );\n\t}\n\n\tprivate registerAgentToRole( agentID:string, roleID:string ):Promise<HTTP.Response.Class> {\n\t\treturn this.rolesService.registerAgent( this.appContext, agentID, roleID );\n\t}\n\n\tprivate removeAgentFromRole( agentID:string, roleID:string ):Promise<HTTP.Response.Class> {\n\t\treturn this.rolesService.removeAgent( this.appContext, agentID, roleID );\n\t}\n\n\tprivate close():void {\n\t\tthis.onClose.emit( true );\n\t}\n\n\tprivate closeError():void {\n\t\tthis.errorMessage = null;\n\t}\n\n\tprivate closeSuccessMessage( event:Event, messageDiv:HTMLElement ):void {\n\t\t$( messageDiv ).transition( {\n\t\t\tanimation: \"fade\",\n\t\t\tonComplete: () => { this.displaySuccessMessage = false; }\n\t\t} );\n\t}\n}\n\nexport class Modes {\n\tstatic READ:string = \"READ\";\n\tstatic EDIT:string = \"EDIT\";\n\tstatic CREATE:string = \"CREATE\";\n}\n\nexport interface AgentFormModel {\n\tslug:string;\n\tname:string;\n\temail:string;\n\troles:string[];\n\tpassword:string;\n\trepeatPassword:string;\n\tenabled:boolean;\n}\n\nexport default AgentDetailsComponent;"]}