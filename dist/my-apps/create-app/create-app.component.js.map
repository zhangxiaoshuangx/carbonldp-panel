{"version":3,"sources":["my-apps/create-app/create-app.component.ts"],"names":[],"mappings":"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","file":"my-apps/create-app/create-app.component.js","sourcesContent":["import { Component, AfterViewInit, OnInit } from \"@angular/core\";\nimport { FormBuilder, ControlGroup, AbstractControl, Control, Validators } from \"@angular/common\";\nimport { ROUTER_DIRECTIVES } from \"@angular/router-deprecated\";\n\nimport Carbon from \"carbonldp/Carbon\";\nimport * as CarbonApp from \"carbonldp/App\";\nimport * as HTTP from \"carbonldp/HTTP\";\nimport * as Pointer from \"carbonldp/Pointer\";\n\nimport { AppContextService } from \"./../app-context.service\";\nimport { ErrorMessageComponent, Message } from \"./../../errors-area/error-message.component\";\n\nimport \"semantic-ui/semantic\";\n\nimport template from \"./create-app.component.html!\";\n\n@Component( {\n\tselector: \"cp-create-app\",\n\ttemplate: template,\n\tstyles: [ \":host { display: block; }\" ],\n\tdirectives: [ ROUTER_DIRECTIVES, ErrorMessageComponent ],\n} )\nexport class CreateAppComponent implements AfterViewInit, OnInit {\n\tcarbon:Carbon;\n\n\tappContextService:AppContextService;\n\n\tsubmitting:boolean = false;\n\tdisplaySuccessMessage:boolean = false;\n\terrorMessage:Message;\n\n\t_name:string = \"\";\n\t_slug:string = \"\";\n\tpersistedSlug:string = \"\";\n\tpersistedName:string = \"\";\n\n\tcreateAppForm:ControlGroup;\n\tformBuilder:FormBuilder;\n\tname:AbstractControl;\n\tslug:AbstractControl;\n\tdescription:AbstractControl;\n\n\n\tconstructor( formBuilder:FormBuilder, carbon:Carbon, appContextService:AppContextService ) {\n\t\tthis.formBuilder = formBuilder;\n\t\tthis.carbon = carbon;\n\t\tthis.appContextService = appContextService;\n\t}\n\n\tngOnInit():void {\n\t\tthis.createAppForm = this.formBuilder.group( {\n\t\t\tname: [ \"\", Validators.compose( [ Validators.required ] ) ],\n\t\t\tslug: [ \"\", Validators.compose( [ this.slugValidator ] ) ],\n\t\t\tdescription: [ \"\", Validators.compose( [ Validators.required ] ) ],\n\t\t} );\n\t\tthis.name = this.createAppForm.controls[ \"name\" ];\n\t\tthis.slug = this.createAppForm.controls[ \"slug\" ];\n\t\tthis.description = this.createAppForm.controls[ \"description\" ];\n\t}\n\n\tngAfterViewInit():void {\n\t\tthis.name.valueChanges.subscribe(\n\t\t\t( value ):void => {\n\t\t\t\tif( value ) {\n\t\t\t\t\tthis._slug = this.getSanitizedSlug( value );\n\t\t\t\t\tthis.slug.updateValueAndValidity();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tslugLostControl( evt:any ):void {\n\t\tif( ! evt.target.value.match( /^[a-z0-9]+(?:-[a-z0-9]*)*(?:\\/*)$/ ) ) {\n\t\t\t(<Control> this.slug).updateValue( this.getSanitizedSlug( evt.target.value ) );\n\t\t\tthis._slug = this.slug.value;\n\t\t}\n\t}\n\n\tgetSanitizedSlug( slug:string ):string {\n\t\tif( slug ) {\n\t\t\tslug = slug.toLowerCase().replace( /[^\\w ]+/g, \"\" ).replace( / +/g, \"-\" );\n\t\t\tif( slug.charAt( slug.length - 1 ) !== \"/\" ) slug += \"/\";\n\t\t}\n\t\treturn slug;\n\t}\n\n\tcanDisplayErrors():boolean {\n\t\treturn (! this.name.pristine && ! this.name.valid) || (! this.slug.pristine && ! this.slug.valid) || (! this.description.pristine && ! this.description.valid);\n\t}\n\n\tonSubmit( data:{ name:string, slug:string, description:string }, $event:any ):void {\n\t\t$event.preventDefault();\n\n\t\tthis.submitting = true;\n\t\tthis.errorMessage = null;\n\t\tthis.displaySuccessMessage = false;\n\n\t\tthis.name.markAsDirty( true );\n\t\tthis.slug.markAsDirty( true );\n\t\tthis.description.markAsDirty( true );\n\n\t\tif( ! this.createAppForm.valid ) {\n\t\t\tthis.submitting = false;\n\t\t\treturn;\n\t\t}\n\n\t\tlet name:string = data.name;\n\t\tlet slug:string = data.slug;\n\t\tlet description:string = data.description;\n\n\t\tlet appDocument:CarbonApp.Class = CarbonApp.Factory.create( name );\n\t\tappDocument.description = description;\n\t\tappDocument.allowsOrigins = [ Carbon.Pointer.Factory.create( Carbon.NS.CS.Class.AllOrigins ) ];\n\t\tthis.createApp( slug, appDocument );\n\t}\n\n\tcreateApp( slug:string, appDocument:CarbonApp.Class ):Promise<[ Pointer.Class, HTTP.Response.Class]> {\n\t\treturn this.carbon.apps.create( appDocument, slug ).then( ( [appPointer, appCreationResponse]:[ Pointer.Class, HTTP.Response.Class] ) => {\n\t\t\tthis.submitting = false;\n\t\t\tthis.persistedSlug = this._slug;\n\t\t\tthis.persistedName = this._name;\n\t\t\treturn this.carbon.apps.getContext( appPointer );\n\t\t} ).then( ( appContext:CarbonApp.Context ):void => {\n\t\t\tthis.persistedSlug = this.appContextService.getSlug( appContext );\n\t\t\tthis.persistedName = appContext.app.name;\n\t\t\tthis.displaySuccessMessage = true;\n\t\t} ).catch( ( error:HTTP.Errors.Error ) => {\n\t\t\tthis.errorMessage = {\n\t\t\t\ttitle: error.name,\n\t\t\t\tcontent: this.getErrorMessage( error ),\n\t\t\t\tstatusCode: \"\" + error.response.status,\n\t\t\t\tstatusMessage: (<XMLHttpRequest>error.response.request).statusText,\n\t\t\t\tendpoint: (<any>error.response.request).responseURL,\n\t\t\t};\n\t\t\tthis.submitting = false;\n\t\t} );\n\t}\n\n\tgetErrorMessage( error:HTTP.Errors.Error ):string {\n\t\tlet friendlyMessage:string = \"\";\n\t\tswitch( true ) {\n\t\t\tcase error instanceof HTTP.Errors.BadRequestError:\n\t\t\t\tfriendlyMessage = \"\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.ConflictError:\n\t\t\t\tfriendlyMessage = \"There's already a resource with that slug. Error:\" + error.response.status;\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.ForbiddenError:\n\t\t\t\tfriendlyMessage = \"Forbidden Action.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.NotFoundError:\n\t\t\t\tfriendlyMessage = \"Couldn't found the requested URL.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.RequestEntityTooLargeError:\n\t\t\t\tfriendlyMessage = \"Request entity too large.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.UnauthorizedError:\n\t\t\t\tfriendlyMessage = \"Unauthorized operation.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.InternalServerErrorError:\n\t\t\t\tfriendlyMessage = \"An error occurred while trying to create the app. Please try again later. Error: \" + error.response.status;\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.ServiceUnavailableError:\n\t\t\t\tfriendlyMessage = \"Service currently unavailable.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.UnknownError:\n\t\t\t\tfriendlyMessage = \"An error occurred while trying to create the app. Please try again later. Error: \" + error.response.status;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tfriendlyMessage = \"There was a problem processing the request. Error: \" + error.response.status;\n\t\t\t\tbreak;\n\t\t}\n\t\treturn friendlyMessage;\n\t}\n\n\n\tslugValidator( slug:Control ):any {\n\t\tif( ! slug.value ) return null;\n\t\tif( slug.value.match( /^[a-z0-9]+(?:-[a-z0-9]*)*(?:\\/*)$/ ) ) {\n\t\t\treturn null;\n\t\t}\n\t\treturn { \"invalidSlug\": true };\n\t}\n\n\tclearMessages( evt:Event ):void {\n\t\tthis.displaySuccessMessage = false;\n\t\tthis.errorMessage = null;\n\t}\n}\n\nexport default CreateAppComponent;\n"],"sourceRoot":"/source/"}