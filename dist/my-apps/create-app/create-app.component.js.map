{"version":3,"sources":["my-apps/create-app/create-app.component.ts"],"names":[],"mappings":"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","file":"create-app.component.js","sourcesContent":["import { Component, OnInit } from \"@angular/core\";\nimport { Router } from \"@angular/router\";\n\nimport Carbon from \"carbonldp/Carbon\";\nimport * as CarbonApp from \"carbonldp/App\";\nimport * as HTTP from \"carbonldp/HTTP\";\nimport * as Pointer from \"carbonldp/Pointer\";\nimport * as Auth from \"carbonldp/Auth\";\nimport * as CS from \"carbonldp/NS/CS\";\nimport * as PersistedProtectedDocument from \"carbonldp/PersistedProtectedDocument\";\nimport * as PersistedDocument from \"carbonldp/PersistedDocument\";\n\nimport { AppContextService } from \"./../app-context.service\";\nimport { Message } from \"./../../errors-area/error-message.component\";\n\n\nimport \"semantic-ui/semantic\";\n\n@Component( {\n\tselector: \"cp-create-app\",\n\ttemplate: require( \"./create-app.component.html\" ),\n\tstyles: [ \":host { display: block; }\" ],\n} )\nexport class CreateAppComponent implements OnInit {\n\tprivate carbon:Carbon;\n\tprivate router:Router;\n\n\tprivate appContextService:AppContextService;\n\n\tprivate submitting:boolean = false;\n\tprivate displaySuccessMessage:boolean = false;\n\tprivate displayWarningMessage:boolean = false;\n\tprivate errorMessage:Message;\n\n\tprivate _name:string = \"\";\n\tprivate _slug:string = \"\";\n\tprivate persistedSlug:string = \"\";\n\tprivate persistedName:string = \"\";\n\n\tprivate slugInput;\n\tprivate createAppFormModel:{ name:string, slug:string, description:string } = {\n\t\tname: \"\",\n\t\tslug: \"\",\n\t\tdescription: \"\"\n\t};\n\n\tconstructor( carbon:Carbon, appContextService:AppContextService, router:Router ) {\n\t\tthis.carbon = carbon;\n\t\tthis.appContextService = appContextService;\n\t\tthis.router = router;\n\t}\n\n\tngOnInit():void {\n\t\tthis.slugInput = $( \"form > :input[name='slug']\" );\n\t}\n\n\n\tprivate slugLostControl( evt:any ):void {\n\t\tif( typeof evt.target === \"undefined\" ) return;\n\t\tif( ! evt.target.value.match( /^[a-z0-9]+(?:-[a-z0-9]*)*(?:\\/*)$/ ) )\n\t\t\tthis.createAppFormModel.slug = this.getSanitizedSlug( evt.target.value );\n\t\tif( ! this.createAppFormModel.slug.endsWith( \"/\" ) && this.createAppFormModel.slug.trim() !== \"\" ) this.createAppFormModel.slug += \"/\";\n\t}\n\n\tprivate getSanitizedSlug( slug:string ):string {\n\t\tif( typeof slug === \"undefined\" ) return slug;\n\t\tslug = slug.toLowerCase().replace( / - | -|- /g, \"-\" ).replace( /[^-\\w ]+/g, \"\" ).replace( / +/g, \"-\" );\n\t\treturn slug;\n\t}\n\n\tprivate onSubmit( form:any, $event:any ):void {\n\t\t$event.preventDefault();\n\n\t\tthis.submitting = true;\n\t\tthis.errorMessage = null;\n\t\tthis.displaySuccessMessage = false;\n\t\tthis.displayWarningMessage = false;\n\n\t\tif( ! form.valid ) {\n\t\t\tthis.submitting = false;\n\t\t\treturn;\n\t\t}\n\n\t\tlet name:string = form.value.name;\n\t\tlet slug:string = form.value.slug;\n\t\tlet description:string = form.value.description;\n\n\t\tlet appDocument:CarbonApp.Class = CarbonApp.Factory.create( name );\n\t\tappDocument.description = description;\n\t\tappDocument.allowsOrigins = [ Carbon.Pointer.Factory.create( Carbon.NS.CS.Class.AllOrigins ) ];\n\t\tthis.createApp( slug, appDocument );\n\t}\n\n\tprivate createApp( slug:string, appDocument:CarbonApp.Class ):Promise<Auth.PersistedACL.Class> {\n\t\treturn this.carbon.apps.create( appDocument, slug ).then( ( [ appPointer, appCreationResponse ]:[ Pointer.Class, HTTP.Response.Class ] ) => {\n\t\t\tthis.persistedSlug = this._slug;\n\t\t\tthis.persistedName = this._name;\n\t\t\treturn this.carbon.apps.getContext( appPointer );\n\t\t} ).then( ( appContext:CarbonApp.Context ) => {\n\t\t\tthis.persistedSlug = this.appContextService.getSlug( appContext );\n\t\t\tthis.persistedName = appContext.app.name;\n\t\t\tlet persistedAppDocument:PersistedProtectedDocument.Class = (<PersistedProtectedDocument.Class>(<PersistedDocument.Class>appContext.app));\n\t\t\treturn persistedAppDocument.getACL();\n\t\t} ).then( ( [ acl, response ]:[ Auth.PersistedACL.Class, HTTP.Response.Class ] ) => {\n\t\t\treturn this.grantAccess( acl );\n\t\t} ).catch( ( error:HTTP.Errors.Error ) => {\n\t\t\tconsole.error( error );\n\t\t\tif( error.response ) this.errorMessage = this.getHTTPErrorMessage( error, this.getErrorMessage( error ) );\n\t\t\telse {\n\t\t\t\tthis.errorMessage = <Message>{\n\t\t\t\t\ttitle: error.name,\n\t\t\t\t\tcontent: JSON.stringify( error )\n\t\t\t\t};\n\t\t\t}\n\t\t} ).then( () => {\n\t\t\tthis.submitting = false;\n\t\t} );\n\t}\n\n\tprivate grantAccess( acl:Auth.PersistedACL.Class ):Promise<Auth.PersistedACL.Class> {\n\t\tlet subject:string = this.carbon.resolve( \"roles/anonymous/\" ),\n\t\t\tsubjectClass:string = CS.namespace + \"PlatformRole\",\n\t\t\tpermissions:string[] = [ CS.namespace + \"Read\" ];\n\t\tacl.grant( subject, subjectClass, permissions );\n\t\treturn acl.saveAndRefresh().then( () => {\n\t\t\tthis.displaySuccessMessage = true;\n\t\t\tthis.router.navigate( [ \"my-apps/\", this.persistedSlug ] );\n\t\t} ).catch( ( error:HTTP.Errors.Error ) => {\n\t\t\tthis.displayWarningMessage = true;\n\t\t} ).then( () => {\n\t\t\treturn acl;\n\t\t} );\n\t}\n\n\tprivate getHTTPErrorMessage( error:HTTP.Errors.Error, content:string ):Message {\n\t\treturn {\n\t\t\ttitle: error.name,\n\t\t\tcontent: content + (! ! error.message ? (\" Reason: \" + error.message) : \"\"),\n\t\t\tendpoint: (<any>error.response.request).responseURL,\n\t\t\tstatusCode: \"\" + (<XMLHttpRequest>error.response.request).status + \" - RequestID: \" + error.requestID,\n\t\t\tstatusMessage: (<XMLHttpRequest>error.response.request).statusText\n\t\t};\n\t}\n\n\tprivate getErrorMessage( error:HTTP.Errors.Error ):string {\n\t\tlet friendlyMessage:string = \"\";\n\t\tswitch( true ) {\n\t\t\tcase error instanceof HTTP.Errors.BadRequestError:\n\t\t\t\tfriendlyMessage = \"\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.ConflictError:\n\t\t\t\tfriendlyMessage = \"There's already a resource with that slug. Error:\" + error.response.status;\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.ForbiddenError:\n\t\t\t\tfriendlyMessage = \"Forbidden Action.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.NotFoundError:\n\t\t\t\tfriendlyMessage = \"Couldn't found the requested URL.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.RequestEntityTooLargeError:\n\t\t\t\tfriendlyMessage = \"Request entity too large.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.UnauthorizedError:\n\t\t\t\tfriendlyMessage = \"Unauthorized operation.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.InternalServerErrorError:\n\t\t\t\tfriendlyMessage = \"An error occurred while trying to create the app. Please try again later. Error: \" + error.response.status;\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.ServiceUnavailableError:\n\t\t\t\tfriendlyMessage = \"Service currently unavailable.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.UnknownError:\n\t\t\t\tfriendlyMessage = \"An error occurred while trying to create the app. Please try again later. Error: \" + error.response.status;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tfriendlyMessage = \"There was a problem processing the request. Error: \" + error.response.status;\n\t\t\t\tbreak;\n\t\t}\n\t\treturn friendlyMessage;\n\t}\n\n\tprivate clearMessages( evt:Event ):void {\n\t\tthis.displaySuccessMessage = false;\n\t\tthis.displayWarningMessage = false;\n\t\tthis.errorMessage = null;\n\t}\n}\n\nexport default CreateAppComponent;\n"]}