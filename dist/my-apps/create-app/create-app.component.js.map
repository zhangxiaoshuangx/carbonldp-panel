{"version":3,"sources":["my-apps/create-app/create-app.component.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAyBA;gBAuBC,4BAAa,MAAa,EAAE,iBAAmC,EAAE,MAAa;oBAjBtE,eAAU,GAAW,KAAK,CAAC;oBAC3B,0BAAqB,GAAW,KAAK,CAAC;oBACtC,0BAAqB,GAAW,KAAK,CAAC;oBAGtC,UAAK,GAAU,EAAE,CAAC;oBAClB,UAAK,GAAU,EAAE,CAAC;oBAClB,kBAAa,GAAU,EAAE,CAAC;oBAC1B,kBAAa,GAAU,EAAE,CAAC;oBAG1B,uBAAkB,GAAoD;wBAC7E,IAAI,EAAE,EAAE;wBACR,IAAI,EAAE,EAAE;wBACR,WAAW,EAAE,EAAE;qBACf,CAAC;oBAGD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;oBACrB,IAAI,CAAC,iBAAiB,GAAG,iBAAiB,CAAC;oBAC3C,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;gBACtB,CAAC;gBAED,qCAAQ,GAAR;oBACC,IAAI,CAAC,SAAS,GAAG,CAAC,CAAE,4BAA4B,CAAE,CAAC;gBACpD,CAAC;gBAGO,4CAAe,GAAvB,UAAyB,GAAO;oBAC/B,EAAE,CAAA,CAAE,OAAO,GAAG,CAAC,MAAM,KAAK,WAAY,CAAC;wBAAC,MAAM,CAAC;oBAC/C,EAAE,CAAA,CAAE,CAAE,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAE,mCAAmC,CAAG,CAAC;wBACpE,IAAI,CAAC,kBAAkB,CAAC,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAE,GAAG,CAAC,MAAM,CAAC,KAAK,CAAE,CAAC;oBAC1E,EAAE,CAAA,CAAE,CAAE,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,QAAQ,CAAE,GAAG,CAAE,IAAI,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,EAAG,CAAC;wBAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,IAAI,GAAG,CAAC;gBACxI,CAAC;gBAEO,6CAAgB,GAAxB,UAA0B,IAAW;oBACpC,EAAE,CAAA,CAAE,OAAO,IAAI,KAAK,WAAY,CAAC;wBAAC,MAAM,CAAC,IAAI,CAAC;oBAC9C,IAAI,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC,OAAO,CAAE,YAAY,EAAE,GAAG,CAAE,CAAC,OAAO,CAAE,WAAW,EAAE,EAAE,CAAE,CAAC,OAAO,CAAE,KAAK,EAAE,GAAG,CAAE,CAAC;oBACxG,MAAM,CAAC,IAAI,CAAC;gBACb,CAAC;gBAEO,qCAAQ,GAAhB,UAAkB,IAAQ,EAAE,MAAU;oBACrC,MAAM,CAAC,cAAc,EAAE,CAAC;oBAExB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;oBACvB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;oBACzB,IAAI,CAAC,qBAAqB,GAAG,KAAK,CAAC;oBACnC,IAAI,CAAC,qBAAqB,GAAG,KAAK,CAAC;oBAEnC,EAAE,CAAA,CAAE,CAAE,IAAI,CAAC,KAAM,CAAC,CAAC,CAAC;wBACnB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;wBACxB,MAAM,CAAC;oBACR,CAAC;oBAED,IAAI,IAAI,GAAU,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;oBAClC,IAAI,IAAI,GAAU,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;oBAClC,IAAI,WAAW,GAAU,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;oBAEhD,IAAI,WAAW,GAAmB,SAAS,CAAC,OAAO,CAAC,MAAM,CAAE,IAAI,CAAE,CAAC;oBACnE,WAAW,CAAC,WAAW,GAAG,WAAW,CAAC;oBACtC,WAAW,CAAC,aAAa,GAAG,CAAE,gBAAM,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAE,gBAAM,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,CAAE,CAAE,CAAC;oBAC/F,IAAI,CAAC,SAAS,CAAE,IAAI,EAAE,WAAW,CAAE,CAAC;gBACrC,CAAC;gBAEO,sCAAS,GAAjB,UAAmB,IAAW,EAAE,WAA2B;oBAA3D,iBAwBC;oBAvBA,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAE,WAAW,EAAE,IAAI,CAAE,CAAC,IAAI,CAAE,UAAE,EAA0E;4BAAxE,kBAAU,EAAE,2BAAmB;wBAC5F,KAAI,CAAC,aAAa,GAAG,KAAI,CAAC,KAAK,CAAC;wBAChC,KAAI,CAAC,aAAa,GAAG,KAAI,CAAC,KAAK,CAAC;wBAChC,MAAM,CAAC,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAE,UAAU,CAAE,CAAC;oBAClD,CAAC,CAAE,CAAC,IAAI,CAAE,UAAE,UAA4B;wBACvC,KAAI,CAAC,aAAa,GAAG,KAAI,CAAC,iBAAiB,CAAC,OAAO,CAAE,UAAU,CAAE,CAAC;wBAClE,KAAI,CAAC,aAAa,GAAG,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC;wBACzC,IAAI,oBAAoB,GAAiG,UAAU,CAAC,GAAK,CAAC;wBAC1I,MAAM,CAAC,oBAAoB,CAAC,MAAM,EAAE,CAAC;oBACtC,CAAC,CAAE,CAAC,IAAI,CAAE,UAAE,EAAkE;4BAAhE,WAAG,EAAE,gBAAQ;wBAC1B,MAAM,CAAC,KAAI,CAAC,WAAW,CAAE,GAAG,CAAE,CAAC;oBAChC,CAAC,CAAE,CAAC,KAAK,CAAE,UAAE,KAAuB;wBACnC,OAAO,CAAC,KAAK,CAAE,KAAK,CAAE,CAAC;wBACvB,EAAE,CAAA,CAAE,KAAK,CAAC,QAAS,CAAC;4BAAC,KAAI,CAAC,YAAY,GAAG,KAAI,CAAC,mBAAmB,CAAE,KAAK,EAAE,KAAI,CAAC,eAAe,CAAE,KAAK,CAAE,CAAE,CAAC;wBAC1G,IAAI,CAAC,CAAC;4BACL,KAAI,CAAC,YAAY,GAAY;gCAC5B,KAAK,EAAE,KAAK,CAAC,IAAI;gCACjB,OAAO,EAAE,IAAI,CAAC,SAAS,CAAE,KAAK,CAAE;6BAChC,CAAC;wBACH,CAAC;oBACF,CAAC,CAAE,CAAC,IAAI,CAAE;wBACT,KAAI,CAAC,UAAU,GAAG,KAAK,CAAC;oBACzB,CAAC,CAAE,CAAC;gBACL,CAAC;gBAEO,wCAAW,GAAnB,UAAqB,GAA2B;oBAAhD,iBAaC;oBAZA,IAAI,OAAO,GAAU,IAAI,CAAC,MAAM,CAAC,OAAO,CAAE,kBAAkB,CAAE,EAC7D,YAAY,GAAU,EAAE,CAAC,SAAS,GAAG,cAAc,EACnD,WAAW,GAAY,CAAE,EAAE,CAAC,SAAS,GAAG,MAAM,CAAE,CAAC;oBAClD,GAAG,CAAC,KAAK,CAAE,OAAO,EAAE,YAAY,EAAE,WAAW,CAAE,CAAC;oBAChD,MAAM,CAAC,GAAG,CAAC,cAAc,EAAE,CAAC,IAAI,CAAE;wBACjC,KAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC;wBAClC,KAAI,CAAC,MAAM,CAAC,QAAQ,CAAE,CAAE,UAAU,EAAE,KAAI,CAAC,aAAa,CAAE,CAAE,CAAC;oBAC5D,CAAC,CAAE,CAAC,KAAK,CAAE,UAAE,KAAuB;wBACnC,KAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC;oBACnC,CAAC,CAAE,CAAC,IAAI,CAAE;wBACT,MAAM,CAAC,GAAG,CAAC;oBACZ,CAAC,CAAE,CAAC;gBACL,CAAC;gBAEO,gDAAmB,GAA3B,UAA6B,KAAuB,EAAE,OAAc;oBACnE,MAAM,CAAC;wBACN,KAAK,EAAE,KAAK,CAAC,IAAI;wBACjB,OAAO,EAAE,OAAO,GAAG,CAAC,CAAE,CAAE,KAAK,CAAC,OAAO,GAAG,CAAC,WAAW,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;wBAC3E,QAAQ,EAAQ,KAAK,CAAC,QAAQ,CAAC,OAAQ,CAAC,WAAW;wBACnD,UAAU,EAAE,EAAE,GAAoB,KAAK,CAAC,QAAQ,CAAC,OAAQ,CAAC,MAAM,GAAG,gBAAgB,GAAG,KAAK,CAAC,SAAS;wBACrG,aAAa,EAAmB,KAAK,CAAC,QAAQ,CAAC,OAAQ,CAAC,UAAU;qBAClE,CAAC;gBACH,CAAC;gBAEO,4CAAe,GAAvB,UAAyB,KAAuB;oBAC/C,IAAI,eAAe,GAAU,EAAE,CAAC;oBAChC,MAAM,CAAA,CAAE,IAAK,CAAC,CAAC,CAAC;wBACf,KAAK,KAAK,YAAY,IAAI,CAAC,MAAM,CAAC,eAAe;4BAChD,eAAe,GAAG,EAAE,CAAC;4BACrB,KAAK,CAAC;wBACP,KAAK,KAAK,YAAY,IAAI,CAAC,MAAM,CAAC,aAAa;4BAC9C,eAAe,GAAG,mDAAmD,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC;4BAC9F,KAAK,CAAC;wBACP,KAAK,KAAK,YAAY,IAAI,CAAC,MAAM,CAAC,cAAc;4BAC/C,eAAe,GAAG,mBAAmB,CAAC;4BACtC,KAAK,CAAC;wBACP,KAAK,KAAK,YAAY,IAAI,CAAC,MAAM,CAAC,aAAa;4BAC9C,eAAe,GAAG,mCAAmC,CAAC;4BACtD,KAAK,CAAC;wBACP,KAAK,KAAK,YAAY,IAAI,CAAC,MAAM,CAAC,0BAA0B;4BAC3D,eAAe,GAAG,2BAA2B,CAAC;4BAC9C,KAAK,CAAC;wBACP,KAAK,KAAK,YAAY,IAAI,CAAC,MAAM,CAAC,iBAAiB;4BAClD,eAAe,GAAG,yBAAyB,CAAC;4BAC5C,KAAK,CAAC;wBACP,KAAK,KAAK,YAAY,IAAI,CAAC,MAAM,CAAC,wBAAwB;4BACzD,eAAe,GAAG,mFAAmF,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC;4BAC9H,KAAK,CAAC;wBACP,KAAK,KAAK,YAAY,IAAI,CAAC,MAAM,CAAC,uBAAuB;4BACxD,eAAe,GAAG,gCAAgC,CAAC;4BACnD,KAAK,CAAC;wBACP,KAAK,KAAK,YAAY,IAAI,CAAC,MAAM,CAAC,YAAY;4BAC7C,eAAe,GAAG,mFAAmF,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC;4BAC9H,KAAK,CAAC;wBACP;4BACC,eAAe,GAAG,qDAAqD,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC;4BAChG,KAAK,CAAC;oBACR,CAAC;oBACD,MAAM,CAAC,eAAe,CAAC;gBACxB,CAAC;gBAEO,0CAAa,GAArB,UAAuB,GAAS;oBAC/B,IAAI,CAAC,qBAAqB,GAAG,KAAK,CAAC;oBACnC,IAAI,CAAC,qBAAqB,GAAG,KAAK,CAAC;oBACnC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;gBAC1B,CAAC;gBAvKF;oBAAC,gBAAS,CAAE;wBACX,QAAQ,EAAE,eAAe;wBACzB,QAAQ,EAAE,mCAAQ;wBAClB,MAAM,EAAE,CAAE,2BAA2B,CAAE;qBACvC,CAAE;;sCAAA;gBAoKH,yBAAC;YAAD,CAnKA,AAmKC,IAAA;YAnKD,mDAmKC,CAAA;YAED,oBAAe,kBAAkB,EAAC","file":"create-app.component.js","sourcesContent":["import { Component, OnInit } from \"@angular/core\";\nimport { Router } from \"@angular/router\";\n\nimport Carbon from \"carbonldp/Carbon\";\nimport * as CarbonApp from \"carbonldp/App\";\nimport * as HTTP from \"carbonldp/HTTP\";\nimport * as Pointer from \"carbonldp/Pointer\";\nimport * as Auth from \"carbonldp/Auth\";\nimport * as CS from \"carbonldp/NS/CS\";\nimport * as PersistedProtectedDocument from \"carbonldp/PersistedProtectedDocument\";\nimport * as PersistedDocument from \"carbonldp/PersistedDocument\";\n\nimport { AppContextService } from \"./../app-context.service\";\nimport { Message } from \"./../../errors-area/error-message.component\";\n\n\nimport \"semantic-ui/semantic\";\n\nimport template from \"./create-app.component.html!\";\n\n@Component( {\n\tselector: \"cp-create-app\",\n\ttemplate: template,\n\tstyles: [ \":host { display: block; }\" ],\n} )\nexport class CreateAppComponent implements OnInit {\n\tprivate carbon:Carbon;\n\tprivate router:Router;\n\n\tprivate appContextService:AppContextService;\n\n\tprivate submitting:boolean = false;\n\tprivate displaySuccessMessage:boolean = false;\n\tprivate displayWarningMessage:boolean = false;\n\tprivate errorMessage:Message;\n\n\tprivate _name:string = \"\";\n\tprivate _slug:string = \"\";\n\tprivate persistedSlug:string = \"\";\n\tprivate persistedName:string = \"\";\n\n\tprivate slugInput;\n\tprivate createAppFormModel:{ name:string, slug:string, description:string } = {\n\t\tname: \"\",\n\t\tslug: \"\",\n\t\tdescription: \"\"\n\t};\n\n\tconstructor( carbon:Carbon, appContextService:AppContextService, router:Router ) {\n\t\tthis.carbon = carbon;\n\t\tthis.appContextService = appContextService;\n\t\tthis.router = router;\n\t}\n\n\tngOnInit():void {\n\t\tthis.slugInput = $( \"form > :input[name='slug']\" );\n\t}\n\n\n\tprivate slugLostControl( evt:any ):void {\n\t\tif( typeof evt.target === \"undefined\" ) return;\n\t\tif( ! evt.target.value.match( /^[a-z0-9]+(?:-[a-z0-9]*)*(?:\\/*)$/ ) )\n\t\t\tthis.createAppFormModel.slug = this.getSanitizedSlug( evt.target.value );\n\t\tif( ! this.createAppFormModel.slug.endsWith( \"/\" ) && this.createAppFormModel.slug.trim() !== \"\" ) this.createAppFormModel.slug += \"/\";\n\t}\n\n\tprivate getSanitizedSlug( slug:string ):string {\n\t\tif( typeof slug === \"undefined\" ) return slug;\n\t\tslug = slug.toLowerCase().replace( / - | -|- /g, \"-\" ).replace( /[^-\\w ]+/g, \"\" ).replace( / +/g, \"-\" );\n\t\treturn slug;\n\t}\n\n\tprivate onSubmit( form:any, $event:any ):void {\n\t\t$event.preventDefault();\n\n\t\tthis.submitting = true;\n\t\tthis.errorMessage = null;\n\t\tthis.displaySuccessMessage = false;\n\t\tthis.displayWarningMessage = false;\n\n\t\tif( ! form.valid ) {\n\t\t\tthis.submitting = false;\n\t\t\treturn;\n\t\t}\n\n\t\tlet name:string = form.value.name;\n\t\tlet slug:string = form.value.slug;\n\t\tlet description:string = form.value.description;\n\n\t\tlet appDocument:CarbonApp.Class = CarbonApp.Factory.create( name );\n\t\tappDocument.description = description;\n\t\tappDocument.allowsOrigins = [ Carbon.Pointer.Factory.create( Carbon.NS.CS.Class.AllOrigins ) ];\n\t\tthis.createApp( slug, appDocument );\n\t}\n\n\tprivate createApp( slug:string, appDocument:CarbonApp.Class ):Promise<Auth.PersistedACL.Class> {\n\t\treturn this.carbon.apps.create( appDocument, slug ).then( ( [ appPointer, appCreationResponse ]:[ Pointer.Class, HTTP.Response.Class ] ) => {\n\t\t\tthis.persistedSlug = this._slug;\n\t\t\tthis.persistedName = this._name;\n\t\t\treturn this.carbon.apps.getContext( appPointer );\n\t\t} ).then( ( appContext:CarbonApp.Context ) => {\n\t\t\tthis.persistedSlug = this.appContextService.getSlug( appContext );\n\t\t\tthis.persistedName = appContext.app.name;\n\t\t\tlet persistedAppDocument:PersistedProtectedDocument.Class = (<PersistedProtectedDocument.Class>(<PersistedDocument.Class>appContext.app));\n\t\t\treturn persistedAppDocument.getACL();\n\t\t} ).then( ( [ acl, response ]:[ Auth.PersistedACL.Class, HTTP.Response.Class ] ) => {\n\t\t\treturn this.grantAccess( acl );\n\t\t} ).catch( ( error:HTTP.Errors.Error ) => {\n\t\t\tconsole.error( error );\n\t\t\tif( error.response ) this.errorMessage = this.getHTTPErrorMessage( error, this.getErrorMessage( error ) );\n\t\t\telse {\n\t\t\t\tthis.errorMessage = <Message>{\n\t\t\t\t\ttitle: error.name,\n\t\t\t\t\tcontent: JSON.stringify( error )\n\t\t\t\t};\n\t\t\t}\n\t\t} ).then( () => {\n\t\t\tthis.submitting = false;\n\t\t} );\n\t}\n\n\tprivate grantAccess( acl:Auth.PersistedACL.Class ):Promise<Auth.PersistedACL.Class> {\n\t\tlet subject:string = this.carbon.resolve( \"roles/anonymous/\" ),\n\t\t\tsubjectClass:string = CS.namespace + \"PlatformRole\",\n\t\t\tpermissions:string[] = [ CS.namespace + \"Read\" ];\n\t\tacl.grant( subject, subjectClass, permissions );\n\t\treturn acl.saveAndRefresh().then( () => {\n\t\t\tthis.displaySuccessMessage = true;\n\t\t\tthis.router.navigate( [ \"my-apps/\", this.persistedSlug ] );\n\t\t} ).catch( ( error:HTTP.Errors.Error ) => {\n\t\t\tthis.displayWarningMessage = true;\n\t\t} ).then( () => {\n\t\t\treturn acl;\n\t\t} );\n\t}\n\n\tprivate getHTTPErrorMessage( error:HTTP.Errors.Error, content:string ):Message {\n\t\treturn {\n\t\t\ttitle: error.name,\n\t\t\tcontent: content + (! ! error.message ? (\" Reason: \" + error.message) : \"\"),\n\t\t\tendpoint: (<any>error.response.request).responseURL,\n\t\t\tstatusCode: \"\" + (<XMLHttpRequest>error.response.request).status + \" - RequestID: \" + error.requestID,\n\t\t\tstatusMessage: (<XMLHttpRequest>error.response.request).statusText\n\t\t};\n\t}\n\n\tprivate getErrorMessage( error:HTTP.Errors.Error ):string {\n\t\tlet friendlyMessage:string = \"\";\n\t\tswitch( true ) {\n\t\t\tcase error instanceof HTTP.Errors.BadRequestError:\n\t\t\t\tfriendlyMessage = \"\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.ConflictError:\n\t\t\t\tfriendlyMessage = \"There's already a resource with that slug. Error:\" + error.response.status;\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.ForbiddenError:\n\t\t\t\tfriendlyMessage = \"Forbidden Action.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.NotFoundError:\n\t\t\t\tfriendlyMessage = \"Couldn't found the requested URL.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.RequestEntityTooLargeError:\n\t\t\t\tfriendlyMessage = \"Request entity too large.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.UnauthorizedError:\n\t\t\t\tfriendlyMessage = \"Unauthorized operation.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.InternalServerErrorError:\n\t\t\t\tfriendlyMessage = \"An error occurred while trying to create the app. Please try again later. Error: \" + error.response.status;\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.ServiceUnavailableError:\n\t\t\t\tfriendlyMessage = \"Service currently unavailable.\";\n\t\t\t\tbreak;\n\t\t\tcase error instanceof HTTP.Errors.UnknownError:\n\t\t\t\tfriendlyMessage = \"An error occurred while trying to create the app. Please try again later. Error: \" + error.response.status;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tfriendlyMessage = \"There was a problem processing the request. Error: \" + error.response.status;\n\t\t\t\tbreak;\n\t\t}\n\t\treturn friendlyMessage;\n\t}\n\n\tprivate clearMessages( evt:Event ):void {\n\t\tthis.displaySuccessMessage = false;\n\t\tthis.displayWarningMessage = false;\n\t\tthis.errorMessage = null;\n\t}\n}\n\nexport default CreateAppComponent;\n"]}