<div class="ui top attached title segment">
	<button class="ui icon right floated circular basic mini button" title="Close"
	        (click)="close()">
		<i class="icon remove"></i>
	</button>
	<h3 class="ui header">
		{{agent.name}}
		<span class="sub header">{{agent.id}}</span>
	</h3>
</div>
<div class="ui attached segment" *ngIf="mode !== Modes.CREATE">
	<button *ngIf="mode === Modes.READ"
	        class="ui mini basic icon button"
	        (click)="changeMode(Modes.EDIT)">
		<i class="edit icon"></i>
		Edit
	</button>
	<div class="ui basic label" *ngIf="mode === Modes.EDIT">
		Editing...
	</div>
</div>
<form class="ui attached segment form" #agentForm="ngForm" (submit)="onSubmit(agentForm.value, $event)">
	<div class="ui two column divided grid">
		<div class="stretched row">
			<div class="column">
				<div class="field"
				     [ngClass]="{error: !name.valid}">
					<label>Name:</label>
					<div class="ui fluid input">
						<input type="text" name="name"
						       placeholder="E.g: Agent Name"
						       #name="cpValidation" cpValidation required
						       [(ngModel)]="agentFormModel.name"
						       [disabled]="mode === Modes.READ"
						       (input)="mode === Modes.CREATE? agentFormModel.slug = getSanitizedSlug($event.srcElement.value) : agentFormModel.slug = agentFormModel.slug">
					</div>
				</div>
				<div class="field"
				     [ngClass]="{error: !slug.valid}"
				     *ngIf="mode === Modes.CREATE">
					<label>Slug:</label>
					<div class="ui fluid input">
						<input type="text" name="slug"
						       placeholder="E.g: my-agent-slug/"
						       #slug="cpValidation" cpValidation cp-slug
						       [ngModel]="agentFormModel.slug"
						       (ngModelChange)="agentFormModel.slug = getSanitizedSlug($event)"
						       (blur)="slugLostFocus($event)">
					</div>
				</div>
				<div class="field"
				     [ngClass]="{error: !email.valid}">
					<label>Email:</label>
					<div class="ui left icon fluid input">
						<i class="mail icon"></i>
						<input type="text" name="email"
						       placeholder="E.g: agent@example.com"
						       #email="cpValidation" cpValidation required
						       [(ngModel)]="agentFormModel.email"
						       [disabled]="mode === Modes.READ">
					</div>
				</div>
				<div class="ui divider" *ngIf="mode !== Modes.READ"></div>
				<div class="field"
				     [ngClass]="{ error: !password.valid, hidden: mode !== Modes.CREATE }">
					<label>Password:</label>
					<div class="ui left icon input">
						<i class="lock icon"></i>
						<input type="password" name="password"
						       class="field password"
						       placeholder="Password"
						       #password="cpValidation" cpValidation required
						       [(ngModel)]="agentFormModel.password"
						       [disabled]="mode === Modes.READ">
					</div>
				</div>
				<div class="field"
				     [ngClass]="{ error: !repeatPassword.valid, hidden: mode !== Modes.CREATE }">
					<label>Password Confirmation:</label>
					<div class="ui left icon input">
						<i class="lock icon"></i>
						<input type="password" name="repeatPassword"
						       class="field repeatPassword"
						       placeholder="Repeat password"
						       #repeatPassword="cpValidation" cpValidation required cp-match
						       [(ngModel)]="agentFormModel.repeatPassword"
						       [matchTo]="agentFormModel.password"
						       [control]="repeatPasswordControl"
						       #repeatPasswordControl="ngModel">
					</div>
				</div>
			</div>
			<div class="column">
				<div class="field">
					<label>Roles:</label>
					<div class="ui fluid roles input">
						<select multiple name="roles"
						        class="roles hidden"
						        [(ngModel)]="agentFormModel.roles">
							<option value="">Please Select</option>
							<option *ngFor="let role of agentFormModel.roles" [ngValue]="country">{{role}}</option>
						</select>
						<table class="ui very compact very basic small celled striped roles table" *ngIf="mode === Modes.READ">
							<tbody>
								<tr class="bottom aligned role" *ngFor="let role of agentRoles; let i = index;">
									<td>
										{{role.name}}<br>
										{{role.id}}
									</td>
								</tr>
								<tr class="warning" *ngIf="agentRoles.length===0">
									<td>
										<i class="attention icon"></i>Agent without Roles.
									</td>
								</tr>
							</tbody>
						</table>
						<cp-roles-chooser *ngIf="mode === Modes.EDIT"
						                  [appContext]="appContext"
						                  [selectedRoles]="agentRoles"
						                  [bordered]="false"
						                  (onChangeSelection)="changeRoles($event)"></cp-roles-chooser>
					</div>
				</div>
			</div>
		</div>
	</div>
</form>
<div class="ui attached segment">
	{{agentFormModel | json}}
</div>
<div class="ui bottom attached segment" *ngIf="mode !== Modes.READ">
	<button class="ui mini basic button" title="Cancel" (click)="cancelForm()">Cancel</button>
	<button class="ui mini basic right floated button"
	        [ngClass]="{ 'red': !agentForm.valid, 'green': agentForm.valid  }"
	        (click)="onSubmit(agentForm.value, $event)"
	        [disabled]="!agentForm.valid"
	        [ngSwitch]="mode">
		<span *ngSwitchCase="Modes.CREATE">Create</span>
		<span *ngSwitchCase="Modes.EDIT">Save</span>
		<span *ngSwitchDefault>Save</span>
	</button>
</div>
