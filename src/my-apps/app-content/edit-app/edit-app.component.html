<form [ngFormModel]="editAppForm"
      [ngClass]="{ loading: submitting, error: (!editAppForm.pristine && !editAppForm.valid) }"
      class="ui large form segment editAppForm">
	<div class="field" [ngClass]="{ error: (!name.pristine && !name.valid) }">
		<label>Name:</label>
		<input placeholder="e.g. My First App" type="text" ngControl="name">
	</div>

	<div class="field" [ngClass]="{ error: (!description.pristine && !description.valid) }">
		<label>Description:</label>
		<textarea rows="2" placeholder="Description" ngControl="description"></textarea>
	</div>
	<div class="field">
		<label>Allowed domains:</label>
		<div class="ui segment" ngControlGroup="cors">
			<div class="field">
				<div class="ui toggle checkbox">
					<input type="checkbox" name="allowAllOrigins" ngControl="allDomains">
					<label>Allow all origins.</label>
				</div>
			</div>

			<div class="ui horizontal divider">
				Or
			</div>

			<div class="field" [ngClass]="{disabled: allDomains.value}">
				<div class="ui action input">
					<input type="text"
					       ngControl="domain"
					       [disabled]="allDomains.value"
					       [(ngModel)]="domainStr"
					       placeholder="Enter an address e.g.: http://192.168.1.1 or http://www.domain.com">
					<button class="ui button"
					        (click)="addDomain(domainStr)"
					        [disabled]="!domainStr || corsGroup.hasError('invalidURLAddress')">
						<i class="plus icon"></i>
					</button>
				</div>
			</div>
			<div class="field ui segment" [ngClass]="{disabled: allDomains.value}">
				<ui class="ui middle aligned divided list allowedDomains">
					<li class="item" *ngFor="let opt of allowedDomains; let i = index;">
						<div class="right floated content">
							<button class="ui mini circular icon basic black button"
							        (click)="removeDomain(opt)">
								<i class="remove icon"></i>
							</button>
						</div>
						<div class="bottom aligned content">
							{{opt}}
						</div>
					</li>
				</ui>
				<div *ngIf="allowedDomains.length===0">
					<p class="noAllowedOrigins">No allowed origins to show.</p>
				</div>
			</div>
			<div class="ui error message" *ngIf="corsGroup.hasError('invalidURLAddress')">
				<i class="warning icon"></i>
				Invalid address. Enter a valid address. E.g: http://192.168.1.1 or http://www.domain.com
			</div>
			<div class="ui error message" *ngIf="corsGroup.hasError('emptyAllowedAddresses')">
				<i class="warning icon"></i>
				You have not entered an address, please add at least one or allow all origins.
			</div>
		</div>
	</div>
	<button class="ui submit button"
	        [disabled]="!editAppForm.valid"
	        (click)="onSubmit(editAppForm.value, $event)">
		Submit
	</button>
</form>
<div class="ui bottom attached error message" *ngIf="canDisplayErrors()">
	<ol class="ui list">
		<li value="*" *ngIf="!name.pristine && name.hasError('required')">
			The name is required.
		</li>
		<li value="*" *ngIf="!description.pristine && description.hasError('required')">
			The description is required.
		</li>
	</ol>
</div>
<cp-error-message *ngIf="!!errorMessage"
                  [message]="errorMessage"
                  [closable]="true"
                  (onClose)="clearMessages($event)"></cp-error-message>
<div class="ui bottom attached success message" *ngIf="!!displaySuccessMessage">
	<i class="close icon" (click)="clearMessages($event)"></i>
	The app "{{app.name}}" was edited successfully.
</div>