<div class="ui divided grid segment" [ngClass]="{loading:loadingDocument || savingDocument}">

	<div class="row" *ngIf="messages.length > 0">
		<div class="sixteen wide column">
			<template ngFor let-message="$implicit" [ngForOf]="messages" let-i="index">
				<cp-error-message [message]="message"></cp-error-message>
			</template>
		</div>
	</div>
	<div class="stretched row">
		<cp-document-treeview class="five wide column treeview-container"
		                      [documentContext]="documentContext"
		                      [refreshNode]="onRefreshNode"
		                      [openNode]="onOpenNode"

		                      (onSelectDocument)="changeSelection($event)"
		                      (onShowCreateChildForm)="showCreateChildForm()"
		                      (onShowDeleteChildForm)="showDeleteChildForm()"
		                      (onError)="handleError($event)"
		                      (onLoadingDocument)="onLoadingDocument($event)"
		                      (onResolveUri)="resolveDocument($event)"></cp-document-treeview>
		<cp-document-viewer class="eleven wide column"
		                    [document]="inspectingDocument"
		                    [documentContext]="documentContext"
		                    [displaySuccessMessage]="onDisplaySuccessMessage"

		                    (onRefreshNode)="refreshNode($event)"
		                    (onOpenNode)="openNode($event)"
		                    (onSavingDocument)="showLoading($event)"
		                    (onLoadingDocument)="onLoadingDocument($event)"
		                    (onRefreshDocument)="refreshDocument($event)"></cp-document-viewer>
		<div class="ui create document dimmer">
			<div class="content">
				<div class="ui basic segment center">
					<div class="ui left aligned top attached segment description">
						<h2 class="ui header">Creating a child document</h2>
					</div>
					<div class="ui left aligned attached segment description">
						<form class="ui error createchild form" #createChildForm="ngForm">
							<div class="field"
							     [ngClass]="{error: slug.touched && !slug.valid}">
								<label>Slug: The slug of the document you want to create: (Optional)</label>
								<div class="ui fluid input">
									<input type="text" name="slug"
									       placeholder="Optional: Enter the slug of the child. e.g. &quot;my-child-name/&quot;"
									       #slug="ngModel"
									       cp-slug
									       (keyup.esc)="hideCreateChildForm()"
									       [ngModel]="createChildFormModel.slug"
									       (ngModelChange)="createChildFormModel.slug = getSanitizedSlug($event)"
									       (blur)="slugLostControl($event)">
								</div>
							</div>

							<div class="ui advancedoptions accordion" ngModelGroup="createChildFormModel.advancedOptions" #advancedOptions="ngModelGroup">
								<div class="title">
									<i class="dropdown icon"></i>
									Advanced options
									<div class="ui circular red basic mini label" *ngIf="!advancedOptions.valid">Errors</div>
								</div>
								<div class="content">
									<br>
									<div class="field"
									     [ngClass]="{error: hasMemberRelation.touched && !hasMemberRelation.valid}">
										<label><a href="https://carbonldp.com/documentation/javascript-sdk-getting-started#membership-relation" target="_blank">HasMemberRelation</a>: The name of the property that will hold the array of members (by default member). </label>
										<div class="ui fluid input">
											<input type="text" name="hasMemberRelation"
											       placeholder="E.g: http://www.w3.org/ns/ldp#member"
											       #hasMemberRelation="ngModel"
											       required cp-uri-fragment
											       (keyup.esc)="hideCreateChildForm()"
											       [(ngModel)]="createChildFormModel.advancedOptions.hasMemberRelation">
										</div>
									</div>
									<br>
									<div class="field"
									     [ngClass]="{error: isMemberOfRelation.touched && !isMemberOfRelation.valid}">
										<label><a href="https://carbonldp.com/documentation/javascript-sdk-getting-started#membership-relation" target="_blank">IsMemberOfRelation</a>: The name of the property that each member will have, which links back to the document they are member of (Optional). </label>
										<div class="ui fluid input">
											<input type="text" name="isMemberOfRelation"
											       placeholder="Optional: E.g: http://www.w3.org/ns/ldp#member"
											       #isMemberOfRelation="ngModel"
											       cp-uri-fragment
											       (keyup.esc)="hideCreateChildForm()"
											       [(ngModel)]="createChildFormModel.advancedOptions.isMemberOfRelation">
										</div>
									</div>
								</div>
							</div>

							<div class="ui error message" *ngIf="!createChildForm.valid">
								<ol class="ui list">
									<!--slug-->
									<li value="*" *ngIf="slug.touched && slug.control.hasError('invalidSlug')">
										Please, provide a valid slug/name for the child document.<br>(Only numbers and letters with dashes)
									</li>

									<!--hasMemberRelation-->
									<li value="*" *ngIf="hasMemberRelation.control.hasError('required')">
										The 'hasMemberRelation' property is required.
									</li>
									<li value="*" *ngIf="hasMemberRelation.control.hasError('invalidURIAddress')">
										Please, provide a valid URI for the 'hasMemberRelation' property.<br>
										E.g: http://www.w3.org/ns/ldp#my-member-name
									</li>
									<li value="*" *ngIf="hasMemberRelation.control.hasError('missingFragment')">
										Please, provide a name/fragment for the 'hasMemberRelation' property.<br>
										E.g: http://www.w3.org/ns/ldp#my-member-name
									</li>
									<li value="*" *ngIf="hasMemberRelation.control.hasError('multipleFragment')">
										Please, provide only one name after the hashtag (#) for the 'hasMemberRelation' property.<br>
										E.g: http://www.w3.org/ns/ldp#my-member-name
									</li>

									<!--isMemberOfRelation-->
									<li value="*" *ngIf="isMemberOfRelation.control.hasError('invalidURIAddress')">
										Please, provide a valid URI for the 'isMemberOfRelation' property.<br>
										E.g: http://www.w3.org/ns/ldp#my-member-name
									</li>
									<li value="*" *ngIf="isMemberOfRelation.control.hasError('missingFragment')">
										Please, provide a name/fragment for the 'isMemberOfRelation' property.<br>
										E.g: http://www.w3.org/ns/ldp#my-member-name
									</li>
									<li value="*" *ngIf="isMemberOfRelation.control.hasError('multipleFragment')">
										Please, provide only one name after the hashtag (#) for the 'isMemberOfRelation' property.<br>
										E.g: http://www.w3.org/ns/ldp#my-member-name
									</li>


								</ol>
							</div>


							<div class="ui saving error message transition" *ngIf="!!savingErrorMessage">
								<i class="close icon" (click)="clearSavingError()"></i>
								<div class="header">
									{{savingErrorMessage.title}}
								</div>
								<p>
									<span *ngIf="savingErrorMessage.content">{{savingErrorMessage.content}}<br></span>
									<span *ngIf="savingErrorMessage.statusCode">Status: {{savingErrorMessage.statusCode}} - {{savingErrorMessage.statusMessage}}<br></span>
									<span *ngIf="savingErrorMessage.endpoint">URI: {{savingErrorMessage.endpoint}}</span>
								</p>
								<ol class="ui list" *ngIf="!!savingErrorMessage.errors">
									<li value="*" *ngFor="let error of savingErrorMessage.errors; let i = index;">
										<span *ngIf="!!error['https://carbonldp.com/ns/v1/platform#carbonCode']">Carbon code: {{error["https://carbonldp.com/ns/v1/platform#carbonCode"][0]["@value"]}} -</span>
										<span *ngIf="!!error['https://carbonldp.com/ns/v1/platform#message']">{{error["https://carbonldp.com/ns/v1/platform#message"][0]["@value"]}}</span>
									</li>
								</ol>
							</div>
						</form>
					</div>
					<div class="ui bottom attached left aligned segment">
						<button class="ui mini basic button" title="Cancel creation" (click)="hideCreateChildForm()">Cancel</button>
						<button class="ui mini basic right floated button"
						        [ngClass]="{ 'red': !createChildForm.valid, 'green': createChildForm.valid  }"
						        (click)="createChild()"
						        [disabled]="!createChildForm.valid">Create
						</button>
					</div>
				</div>
			</div>
		</div>
		<div class="ui delete document dimmer">
			<div class="content">
				<div class="center">
					<h2 class="ui inverted header"><i class="trash outline red icon"></i> Are you sure?</h2>
					<p class="ui description">
						<span>You are about to delete the following document:</span><br><br>
						<span>'{{selectedDocumentURI}}'</span><br><br>
						<span>If you delete it, all its children and its access points will also be deleted.</span><br>
						<span>Do you really want to proceed?</span>
					</p>
					<div class="ui red button" title="Confirm deletion" (click)="deleteDocument()">Yes</div>
					<div class="ui button" title="Cancel deletion" (click)="cancelDeletion()">No</div>
				</div>
			</div>
		</div>
	</div>
</div>